<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYC Verification | dLocal Integration</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #16161f;
            --bg-input: #1a1a25;
            --border-color: #2a2a3a;
            --border-focus: #5865f2;
            --text-primary: #f0f0f5;
            --text-secondary: #8888a0;
            --text-muted: #5a5a70;
            --accent-primary: #5865f2;
            --accent-secondary: #7289da;
            --accent-gradient: linear-gradient(135deg, #5865f2 0%, #7c3aed 50%, #ec4899 100%);
            --success: #22c55e;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --shadow-glow: 0 0 60px rgba(88, 101, 242, 0.15);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(88, 101, 242, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 100% 100%, rgba(124, 58, 237, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 24px; }

        /* Header */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 42px;
            height: 42px;
            background: var(--accent-gradient);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        h1 {
            font-size: 24px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle { color: var(--text-muted); font-size: 13px; }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: var(--radius-md);
        }

        .nav-tab {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-tab:hover { color: var(--text-secondary); background: var(--bg-card); }
        .nav-tab.active { color: var(--text-primary); background: var(--accent-primary); }

        /* Main Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 1000px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-icon {
            width: 32px;
            height: 32px;
            background: rgba(88, 101, 242, 0.15);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .card-title { font-size: 16px; font-weight: 600; flex: 1; }

        /* Form Elements */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
        }

        .form-grid.cols-1 { grid-template-columns: 1fr; }
        .form-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group.full-width { grid-column: 1 / -1; }

        label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        label .required { color: var(--error); }

        input, select, textarea {
            font-family: inherit;
            font-size: 13px;
            padding: 10px 12px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            transition: all 0.2s ease;
            width: 100%;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.15);
        }

        input::placeholder { color: var(--text-muted); }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%238888a0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 32px;
        }

        /* Toggle */
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
        }

        .toggle-label { font-size: 13px; }

        .toggle {
            position: relative;
            width: 40px;
            height: 22px;
        }

        .toggle input { opacity: 0; width: 0; height: 0; }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--border-color);
            border-radius: 22px;
            transition: 0.3s;
        }

        .toggle-slider::before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle input:checked + .toggle-slider { background: var(--accent-primary); }
        .toggle input:checked + .toggle-slider::before { transform: translateX(18px); }

        /* Environment Selector */
        .env-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .env-option {
            flex: 1;
            padding: 12px;
            background: var(--bg-input);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .env-option:hover { border-color: var(--text-muted); }
        .env-option.active { border-color: var(--accent-primary); background: rgba(88, 101, 242, 0.1); }
        .env-option input { display: none; }
        .env-option .env-name { font-weight: 600; font-size: 13px; }
        .env-option .env-url { font-size: 10px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }

        /* Profile Selector */
        .profile-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .profile-row select { flex: 1; }

        /* Buttons */
        .btn {
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            padding: 10px 18px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(88, 101, 242, 0.25);
        }

        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(88, 101, 242, 0.35); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover { background: var(--bg-secondary); border-color: var(--text-muted); }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            font-size: 14px;
        }

        .btn-success { background: rgba(34, 197, 94, 0.15); color: var(--success); border: 1px solid rgba(34, 197, 94, 0.3); }
        .btn-danger { background: rgba(239, 68, 68, 0.15); color: var(--error); border: 1px solid rgba(239, 68, 68, 0.3); }

        .btn-block { width: 100%; }

        .actions-bar {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        /* Sections */
        .section {
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 14px;
            overflow: hidden;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            background: var(--bg-input);
            cursor: pointer;
            user-select: none;
        }

        .section-header:hover { background: var(--bg-secondary); }

        .section-title {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-arrow { transition: transform 0.2s ease; }
        .section.open .section-arrow { transform: rotate(180deg); }

        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .section.open .section-content { max-height: 1000px; }
        .section-body { padding: 16px; }

        /* Response Panel */
        .response-panel {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .response-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            background: var(--bg-input);
            border-bottom: 1px solid var(--border-color);
        }

        .response-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.success { background: var(--success); }
        .status-dot.error { background: var(--error); }
        .status-dot.pending { background: var(--warning); animation: pulse 1.5s infinite; }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .response-body {
            padding: 14px;
            max-height: 400px;
            overflow-y: auto;
        }

        .response-body pre {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            line-height: 1.6;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-break: break-all;
        }

        .json-key { color: #7dd3fc; }
        .json-string { color: #86efac; }
        .json-number { color: #fcd34d; }
        .json-boolean { color: #c4b5fd; }
        .json-null { color: #f87171; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon { font-size: 36px; margin-bottom: 12px; opacity: 0.5; }
        .empty-state-text { font-size: 13px; }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 16px;
            gap: 4px;
        }

        .tab {
            padding: 10px 16px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: all 0.2s ease;
        }

        .tab:hover { color: var(--text-secondary); }
        .tab.active { color: var(--accent-primary); border-bottom-color: var(--accent-primary); }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Page Views */
        .page-view { display: none; }
        .page-view.active { display: block; }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            font-size: 10px;
            font-weight: 600;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-sandbox { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .badge-production { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
        .badge-info { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }

        /* File Upload */
        .file-upload {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-upload:hover { border-color: var(--accent-primary); background: rgba(88, 101, 242, 0.05); }
        .file-upload.dragover { border-color: var(--accent-primary); background: rgba(88, 101, 242, 0.1); }
        .file-upload input { display: none; }
        .file-upload-icon { font-size: 32px; margin-bottom: 8px; }
        .file-upload-text { font-size: 13px; color: var(--text-muted); }
        .file-upload-name { font-size: 12px; color: var(--accent-primary); margin-top: 8px; font-weight: 500; }

        /* Info Box */
        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: var(--radius-sm);
            padding: 12px 14px;
            font-size: 12px;
            color: var(--info);
            margin-bottom: 16px;
        }

        /* Spinner */
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        /* Overview Page */
        .overview-grid {
            display: grid;
            gap: 16px;
        }

        .overview-section {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 16px;
        }

        .overview-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .overview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .overview-table th {
            text-align: left;
            padding: 10px 12px;
            background: var(--bg-primary);
            color: var(--text-muted);
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
        }

        .overview-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .overview-table tr:hover td {
            background: rgba(255,255,255,0.02);
        }

        .overview-table tr:last-child td {
            border-bottom: none;
        }

        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-approved { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .status-paid { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .status-pending { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
        .status-rejected { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .status-created { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .status-unknown { background: rgba(107, 114, 128, 0.15); color: #6b7280; }

        .missing-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .missing-item {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .complete-badge {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .action-btns {
            display: flex;
            gap: 6px;
        }

        .action-btn {
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            background: var(--bg-primary);
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--accent);
            color: white;
        }

        .overview-empty {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: var(--radius-md);
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Documentation Styles */
        .docs-tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
        }

        .docs-tab {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .docs-tab:hover { color: var(--text-secondary); background: var(--bg-card); }
        .docs-tab.active { color: var(--text-primary); background: var(--accent-primary); }

        .docs-content { display: none; }
        .docs-content.active { display: block; }

        .docs-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .docs-title {
            font-size: 16px;
            font-weight: 600;
            padding: 16px 20px;
            background: var(--bg-input);
            border-bottom: 1px solid var(--border-color);
            margin: 0;
        }

        .docs-body {
            padding: 20px;
        }

        .docs-body h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 16px 0 10px 0;
        }

        .docs-body h4:first-child { margin-top: 0; }

        .docs-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .docs-list li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
            color: var(--text-secondary);
        }

        .docs-list li:last-child { border-bottom: none; }

        .docs-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .docs-table th,
        .docs-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .docs-table th {
            background: var(--bg-input);
            font-weight: 600;
            color: var(--text-primary);
        }

        .docs-table td {
            color: var(--text-secondary);
        }

        .docs-table code {
            background: var(--bg-input);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }

        .code-block {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            overflow-x: auto;
            white-space: pre;
            margin: 12px 0;
        }

        .docs-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .chip {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Workflow Diagram */
        .workflow-diagram {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px;
            padding: 20px 0;
        }

        .workflow-step {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            min-width: 200px;
            flex: 1;
        }

        .step-number {
            width: 28px;
            height: 28px;
            background: var(--accent-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin: 0 0 4px 0;
            font-size: 14px;
        }

        .step-content p {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: var(--text-muted);
        }

        .step-content code {
            background: var(--bg-primary);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--accent-secondary);
        }

        .workflow-arrow {
            color: var(--text-muted);
            font-size: 20px;
        }

        @media (max-width: 1200px) {
            .workflow-diagram {
                flex-direction: column;
            }
            .workflow-arrow {
                transform: rotate(90deg);
            }
            .workflow-step {
                width: 100%;
            }
        }

        /* API Endpoint Styles */
        .api-endpoint {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            margin: 12px 0;
        }

        .api-method {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .api-method.get { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .api-method.post { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .api-method.patch { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .api-method.delete { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        .api-path {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            color: var(--text-primary);
        }

        .api-desc {
            color: var(--text-muted);
            font-size: 12px;
            margin-left: auto;
        }

        .method-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 700;
        }

        .method-badge.get { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .method-badge.post { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .method-badge.delete { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--error); }
        .toast.info { border-color: var(--info); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            width: 100%;
            max-width: 400px;
            transform: scale(0.95);
            transition: transform 0.2s ease;
        }

        .modal-overlay.active .modal { transform: scale(1); }
        .modal-title { font-size: 16px; font-weight: 600; margin-bottom: 16px; }
        .modal-footer { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }

        /* Utilities */
        .mt-3 { margin-top: 12px; }
        .mt-4 { margin-top: 16px; }
        .mb-3 { margin-bottom: 12px; }
        .mb-4 { margin-bottom: 16px; }
        .text-mono { font-family: 'JetBrains Mono', monospace; }
        .text-sm { font-size: 12px; }
        .text-muted { color: var(--text-muted); }

        /* Documents List */
        .documents-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .document-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: var(--bg-input);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .document-item:hover {
            border-color: var(--accent-primary);
            background: rgba(88, 101, 242, 0.05);
        }

        .document-item.selected {
            border-color: var(--accent-primary);
            background: rgba(88, 101, 242, 0.1);
        }

        .document-item.completed {
            opacity: 0.6;
        }

        .doc-icon {
            font-size: 20px;
            width: 32px;
            text-align: center;
        }

        .doc-info {
            flex: 1;
        }

        .doc-type {
            font-weight: 500;
            font-size: 13px;
            margin-bottom: 2px;
        }

        .doc-id {
            font-size: 11px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .doc-status {
            padding: 4px 10px;
            font-size: 10px;
            font-weight: 600;
            border-radius: 12px;
            text-transform: uppercase;
        }

        .doc-status.pending {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .doc-status.completed, .doc-status.approved {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .doc-status.error, .doc-status.rejected {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .doc-status.in_review {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        .no-documents {
            text-align: center;
            padding: 24px;
            color: var(--text-muted);
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üîê</div>
                <div>
                    <h1>KYC Verification</h1>
                    <p class="subtitle">dLocal Remittances API v1.1</p>
                </div>
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab" data-page="overview">üìä Overview</button>
                <button class="nav-tab active" data-page="create">Create</button>
                <button class="nav-tab" data-page="get">Get Details</button>
                <button class="nav-tab" data-page="documents">Documents</button>
                <button class="nav-tab" data-page="upload">Upload</button>
                <button class="nav-tab" data-page="update-state">üß™ Update State</button>
                <button class="nav-tab" data-page="payment">üí∏ Payment</button>
                <button class="nav-tab" data-page="payment-status">üìä Payment Status</button>
                <button class="nav-tab" data-page="payouts">üè¶ Payouts</button>
                <button class="nav-tab" data-page="docs">üìö Docs</button>
            </nav>
        </header>

        <!-- ============================================ -->
        <!-- OVERVIEW PAGE -->
        <!-- ============================================ -->
        <div class="page-view" id="page-overview">
            <!-- Verifications Overview -->
            <div class="card mb-4">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="card-icon">üìä</div>
                        <h2 class="card-title">KYC Verifications Overview</h2>
                    </div>
                    <button class="btn btn-secondary" onclick="refreshOverview()">
                        üîÑ Refresh All
                    </button>
                </div>
                
                <div id="overview-content" style="padding: 20px;">
                    <div class="overview-loading" style="text-align: center; padding: 40px; color: var(--text-muted);">
                        Loading verifications...
                    </div>
                </div>
            </div>

            <!-- Payments Overview -->
            <div class="card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="card-icon">üí≥</div>
                        <h2 class="card-title">Payments Overview</h2>
                    </div>
                    <button class="btn btn-secondary" onclick="refreshPayments()">
                        üîÑ Refresh
                    </button>
                </div>
                
                <div id="payments-overview-content" style="padding: 20px;">
                    <div class="payments-loading" style="text-align: center; padding: 40px; color: var(--text-muted);">
                        Loading payments...
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- CREATE VERIFICATION PAGE -->
        <!-- ============================================ -->
        <div class="page-view active" id="page-create">
            <div class="main-grid">
                <div class="form-column">
                    <!-- Credentials -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-icon">üîë</div>
                            <h2 class="card-title">API Credentials</h2>
                        </div>

                        <div class="profile-row">
                            <select id="profileSelect" onchange="loadProfile()">
                                <option value="">-- Select saved profile --</option>
                            </select>
                            <button class="btn btn-icon btn-success" onclick="openSaveModal()" title="Save">üíæ</button>
                            <button class="btn btn-icon btn-danger" onclick="deleteProfile()" title="Delete">üóëÔ∏è</button>
                        </div>

                        <div class="env-selector">
                            <label class="env-option active" data-env="sandbox">
                                <input type="radio" name="environment" value="sandbox" checked onchange="toggleSandboxElements()">
                                <div class="env-name">Sandbox</div>
                                <div class="env-url">sandbox.dlocal.com</div>
                            </label>
                            <label class="env-option" data-env="production">
                                <input type="radio" name="environment" value="production" onchange="toggleSandboxElements()">
                                <div class="env-name">Production</div>
                                <div class="env-url">api.dlocal.com</div>
                            </label>
                        </div>

                        <div class="form-grid cols-1">
                            <div class="form-group">
                                <label>Login <span class="required">*</span></label>
                                <input type="text" id="login" placeholder="e.g., 7iRFsVYhe4">
                            </div>
                            <div class="form-group">
                                <label>Transaction Key <span class="required">*</span></label>
                                <input type="text" id="transaction_key" placeholder="e.g., UY1wwtQYXv">
                            </div>
                            <div class="form-group">
                                <label>Secret Key <span class="required">*</span></label>
                                <input type="password" id="secret_key" placeholder="Your secret key">
                            </div>
                        </div>
                    </div>

                    <!-- Verification Form -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìã</div>
                            <h2 class="card-title">Create Verification</h2>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Client Type</label>
                                <select id="client_type" onchange="toggleClientFields()">
                                    <option value="REMITTER">Remitter</option>
                                    <option value="BENEFICIARY">Beneficiary</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>External Reference</label>
                                <input type="text" id="external_reference" value="123456">
                            </div>
                            <div class="form-group full-width">
                                <label>Notification URL</label>
                                <input type="url" id="notification_url" placeholder="https://dlocal-webhook.example.com.br" value="https://dlocal-webhook.example.com.br">
                            </div>
                        </div>

                        <!-- Personal Info -->
                        <div class="section open mt-4">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üë§ Personal Information</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label>First Name <span class="required">*</span></label>
                                            <input type="text" id="first_name" value="John">
                                        </div>
                                        <div class="form-group">
                                            <label>Last Name <span class="required">*</span></label>
                                            <input type="text" id="last_name" value="Doe">
                                        </div>
                                        <div class="form-group">
                                            <label>Date of Birth</label>
                                            <input type="date" id="date_of_birth" value="1990-01-01">
                                        </div>
                                        <div class="form-group">
                                            <label>Place of Birth</label>
                                            <input type="text" id="place_of_birth" value="AR">
                                        </div>
                                        <div class="form-group" id="gender_group">
                                            <label>Gender</label>
                                            <select id="gender">
                                                <option value="MALE">Male</option>
                                                <option value="FEMALE">Female</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Nationality</label>
                                            <input type="text" id="nationality" value="AR">
                                        </div>
                                        <div class="form-group">
                                            <label>Phone <span class="required">*</span></label>
                                            <input type="tel" id="phone" value="+5491122334455" placeholder="+5491122334455">
                                        </div>
                                        <div class="form-group">
                                            <label>Email</label>
                                            <input type="email" id="email" value="john.doe@example.com" placeholder="john.doe@example.com">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Document Info -->
                        <div class="section open">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">ü™™ Document</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label>Document Type</label>
                                            <select id="document_type">
                                                <option value="TAX_ID">TAX ID</option>
                                                <option value="PASSPORT">Passport</option>
                                                <option value="NATIONAL_ID">National ID</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Document Number</label>
                                            <input type="text" id="document_number" value="27327331569">
                                        </div>
                                        <div class="form-group full-width">
                                            <label>Document Country</label>
                                            <input type="text" id="document_country" value="AR">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="section">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üè† Address</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label>Country</label>
                                            <input type="text" id="address_country" value="AR">
                                        </div>
                                        <div class="form-group">
                                            <label>State</label>
                                            <input type="text" id="address_state" value="BA">
                                        </div>
                                        <div class="form-group">
                                            <label>City</label>
                                            <input type="text" id="address_city" value="Buenos Aires">
                                        </div>
                                        <div class="form-group">
                                            <label>Zip Code</label>
                                            <input type="text" id="address_zip_code" value="C1000">
                                        </div>
                                        <div class="form-group">
                                            <label>Street Name</label>
                                            <input type="text" id="address_street_name" value="Florida">
                                        </div>
                                        <div class="form-group">
                                            <label>Street Number</label>
                                            <input type="text" id="address_street_number" value="123">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Remitter Only Fields -->
                        <div id="remitter_fields">
                            <div class="section">
                                <div class="section-header" onclick="toggleSection(this)">
                                    <span class="section-title">‚öñÔ∏è Compliance</span>
                                    <span class="section-arrow">‚ñº</span>
                                </div>
                                <div class="section-content">
                                    <div class="section-body">
                                        <div class="form-grid cols-1">
                                            <div class="form-group">
                                                <label>Marital Status</label>
                                                <select id="marital_status">
                                                    <option value="SINGLE">Single</option>
                                                    <option value="MARRIED">Married</option>
                                                    <option value="DIVORCED">Divorced</option>
                                                    <option value="WIDOWED">Widowed</option>
                                                </select>
                                            </div>
                                            <div class="toggle-row">
                                                <span class="toggle-label">Politically Exposed Person (PEP)</span>
                                                <label class="toggle">
                                                    <input type="checkbox" id="is_pep">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                            <div class="toggle-row">
                                                <span class="toggle-label">Subject Obligated (SO)</span>
                                                <label class="toggle">
                                                    <input type="checkbox" id="is_so">
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group">
                                                <label>Profession</label>
                                                <select id="profession">
                                                    <option value="EMPLOYED">Employed</option>
                                                    <option value="SELF_EMPLOYED">Self Employed</option>
                                                    <option value="STUDENT">Student</option>
                                                    <option value="UNEMPLOYED">Unemployed</option>
                                                    <option value="RETIRED">Retired</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Source of Funds</label>
                                                <select id="source_of_funds">
                                                    <option value="SALARY">Salary</option>
                                                    <option value="SAVINGS">Savings</option>
                                                    <option value="INVESTMENT">Investment</option>
                                                    <option value="INHERITANCE">Inheritance</option>
                                                </select>
                                            </div>
                                            <div class="toggle-row">
                                                <span class="toggle-label">Terms & Conditions Accepted</span>
                                                <label class="toggle">
                                                    <input type="checkbox" id="consent_accepted" checked>
                                                    <span class="toggle-slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Beneficiary Only Fields -->
                        <div id="beneficiary_fields" style="display: none;">
                            <div class="section open">
                                <div class="section-header" onclick="toggleSection(this)">
                                    <span class="section-title">üè¶ Bank Information</span>
                                    <span class="section-arrow">‚ñº</span>
                                </div>
                                <div class="section-content">
                                    <div class="section-body">
                                        <div class="form-grid cols-2">
                                            <div class="form-group">
                                                <label>Bank Account Number <span class="required">*</span></label>
                                                <input type="text" id="bank_account_number" value="1234567890123456" placeholder="Bank account number">
                                            </div>
                                            <div class="form-group">
                                                <label>Bank Code</label>
                                                <input type="text" id="bank_code" value="" placeholder="e.g., 001">
                                            </div>
                                            <div class="form-group">
                                                <label>Bank Branch (IFSC)</label>
                                                <input type="text" id="bank_branch" value="" placeholder="e.g., SBIN0007440">
                                            </div>
                                            <div class="form-group">
                                                <label>Account Type</label>
                                                <select id="bank_account_type">
                                                    <option value="">Select type</option>
                                                    <option value="C">Checking (C)</option>
                                                    <option value="S">Savings (S)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="actions-bar">
                            <button class="btn btn-primary btn-block" id="createBtn" onclick="createVerification()">
                                <span class="btn-text">Create Verification</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Response Panel -->
                <div class="response-column">
                    <div class="card" style="position: sticky; top: 24px;">
                        <div class="card-header">
                            <div class="card-icon">üì°</div>
                            <h2 class="card-title">Response</h2>
                            <span class="badge badge-sandbox" id="envBadge">SANDBOX</span>
                        </div>

                        <div class="tabs">
                            <div class="tab active" data-tab="response">Response</div>
                            <div class="tab" data-tab="response-headers">Headers</div>
                            <div class="tab" data-tab="request">Request</div>
                        </div>

                        <div class="tab-content active" id="tab-response">
                            <div class="response-panel">
                                <div class="empty-state" id="emptyState">
                                    <div class="empty-state-icon">üì≠</div>
                                    <div class="empty-state-text">Send a request to see the response</div>
                                </div>
                                <div id="responseContent" style="display: none;">
                                    <div class="response-header">
                                        <div class="response-status" id="responseStatus">
                                            <span class="status-dot pending"></span>
                                            <span>Waiting...</span>
                                        </div>
                                        <button class="btn btn-secondary text-sm" onclick="copyResponse()">Copy</button>
                                    </div>
                                    <div class="response-body">
                                        <pre id="responseJson"></pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content" id="tab-response-headers">
                            <div class="response-panel">
                                <div class="response-body">
                                    <pre id="responseHeadersJson" class="text-muted">Response headers will appear here</pre>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content" id="tab-request">
                            <div class="response-panel">
                                <div class="response-body">
                                    <pre id="requestJson" class="text-muted">Request body will appear here</pre>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <div class="form-group">
                                <label>Signature</label>
                                <input type="text" id="signaturePreview" readonly class="text-mono text-sm">
                            </div>
                            <div class="form-group mt-3">
                                <label>Request Date</label>
                                <input type="text" id="datePreview" readonly class="text-mono text-sm">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- GET VERIFICATION PAGE -->
        <!-- ============================================ -->
        <div class="page-view" id="page-get">
            <div class="main-grid">
                <div class="form-column">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üîç</div>
                            <h2 class="card-title">Get Verification Details</h2>
                        </div>

                        <div class="info-box">
                            Retrieve the status and details of an existing verification.
                        </div>

                        <div class="form-grid cols-1">
                            <div class="form-group">
                                <label>Select Saved Verification</label>
                                <select id="get_verification_select" onchange="selectVerification('get')">
                                    <option value="">-- Or enter ID manually below --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Verification ID <span class="required">*</span></label>
                                <input type="text" id="get_verification_id" placeholder="KV-570b7da3-7f1a-4d48-b21d-74972732bb9e">
                            </div>
                            <div class="toggle-row">
                                <span class="toggle-label">Include Client Data</span>
                                <label class="toggle">
                                    <input type="checkbox" id="include_client_data">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="actions-bar">
                            <button class="btn btn-primary btn-block" onclick="getVerification()">
                                <span class="btn-text">Get Verification</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="response-column">
                    <div class="card" style="position: sticky; top: 24px;">
                        <div class="card-header">
                            <div class="card-icon">üì°</div>
                            <h2 class="card-title">Response</h2>
                        </div>
                        <div class="response-panel">
                            <div class="empty-state" id="getEmptyState">
                                <div class="empty-state-icon">üì≠</div>
                                <div class="empty-state-text">Enter a verification ID and click Get</div>
                            </div>
                            <div id="getResponseContent" style="display: none;">
                                <div class="response-header">
                                    <div class="response-status" id="getResponseStatus">
                                        <span class="status-dot pending"></span>
                                        <span>Waiting...</span>
                                    </div>
                                    <button class="btn btn-secondary text-sm" onclick="copyGetResponse()">Copy</button>
                                </div>
                                <div class="response-body">
                                    <pre id="getResponseJson"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- GET DOCUMENTS PAGE -->
        <!-- ============================================ -->
        <div class="page-view" id="page-documents">
            <div class="main-grid">
                <div class="form-column">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìÑ</div>
                            <h2 class="card-title">Get Verification Documents</h2>
                        </div>

                        <div class="info-box">
                            Retrieve the list of required documents for a verification.
                        </div>

                        <div class="form-grid cols-1">
                            <div class="form-group">
                                <label>Select Saved Verification</label>
                                <select id="docs_verification_select" onchange="selectVerification('docs')">
                                    <option value="">-- Or enter ID manually below --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Verification ID <span class="required">*</span></label>
                                <input type="text" id="docs_verification_id" placeholder="KV-570b7da3-7f1a-4d48-b21d-74972732bb9e">
                            </div>
                        </div>

                        <div class="actions-bar">
                            <button class="btn btn-primary btn-block" onclick="getDocuments()">
                                <span class="btn-text">Get Documents</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="response-column">
                    <div class="card" style="position: sticky; top: 24px;">
                        <div class="card-header">
                            <div class="card-icon">üì°</div>
                            <h2 class="card-title">Response</h2>
                        </div>
                        <div class="response-panel">
                            <div class="empty-state" id="docsEmptyState">
                                <div class="empty-state-icon">üì≠</div>
                                <div class="empty-state-text">Enter a verification ID and click Get</div>
                            </div>
                            <div id="docsResponseContent" style="display: none;">
                                <div class="response-header">
                                    <div class="response-status" id="docsResponseStatus">
                                        <span class="status-dot pending"></span>
                                        <span>Waiting...</span>
                                    </div>
                                    <button class="btn btn-secondary text-sm" onclick="copyDocsResponse()">Copy</button>
                                </div>
                                <div class="response-body">
                                    <pre id="docsResponseJson"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- UPDATE VERIFICATION STATE PAGE (SANDBOX ONLY) -->
        <!-- ============================================ -->
        <div class="page-view" id="page-update-state">
            <div class="main-grid">
                <div class="form-column">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üß™</div>
                            <h2 class="card-title">Update Verification State</h2>
                            <span class="badge badge-sandbox">SANDBOX ONLY</span>
                        </div>

                        <div class="info-box">
                            <strong>‚ö†Ô∏è Sandbox Testing Tool</strong><br>
                            Modify verification status in the sandbox environment to test state transitions and receive notifications for those states. This simulates the verification flow without waiting for actual processing.
                        </div>

                        <div class="form-grid cols-1">
                            <div class="form-group">
                                <label>Select Saved Verification</label>
                                <select id="update_state_verification_select" onchange="selectVerification('update_state')">
                                    <option value="">-- Or enter ID manually below --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Verification ID <span class="required">*</span></label>
                                <input type="text" id="update_state_verification_id" placeholder="KV-570b7da3-7f1a-4d48-b21d-74972732bb9e">
                            </div>
                            <div class="form-group">
                                <label>New Status <span class="required">*</span></label>
                                <select id="update_state_status" onchange="updateStatusDetailOptions()">
                                    <option value="">-- Select Status --</option>
                                    <option value="CREATING">CREATING</option>
                                    <option value="PENDING">PENDING</option>
                                    <option value="APPROVED">APPROVED</option>
                                    <option value="REJECTED">REJECTED</option>
                                    <option value="EXPIRED">EXPIRED</option>
                                    <option value="ERROR">ERROR</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Status Detail <span class="required">*</span></label>
                                <select id="update_state_status_detail">
                                    <option value="">-- Select status first --</option>
                                </select>
                            </div>
                        </div>

                        <div class="info-box" style="margin-top: 16px;">
                            <strong>Status Descriptions:</strong><br>
                            ‚Ä¢ <strong>CREATING</strong>: Verification is being created<br>
                            ‚Ä¢ <strong>PENDING</strong>: Verification is pending (documentation, review, etc.)<br>
                            ‚Ä¢ <strong>APPROVED</strong>: Verification approved, user can transact<br>
                            ‚Ä¢ <strong>REJECTED</strong>: Verification rejected (legal issues, invalid data, high risk)<br>
                            ‚Ä¢ <strong>EXPIRED</strong>: Verification expired<br>
                            ‚Ä¢ <strong>ERROR</strong>: An error has occurred<br><br>
                            <strong>Status Detail:</strong> Specific reason within the status category. Options change based on selected status.
                        </div>

                        <div class="actions-bar">
                            <button class="btn btn-primary btn-block" onclick="updateVerificationState()">
                                <span class="btn-text">Update State</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="response-column">
                    <div class="card" style="position: sticky; top: 24px;">
                        <div class="card-header">
                            <div class="card-icon">üì°</div>
                            <h2 class="card-title">Response</h2>
                        </div>
                        <div class="response-panel">
                            <div class="empty-state" id="updateStateEmptyState">
                                <div class="empty-state-icon">üì≠</div>
                                <div class="empty-state-text">Select a verification and status, then click Update</div>
                            </div>
                            <div id="updateStateResponseContent" style="display: none;">
                                <div class="response-header">
                                    <div class="response-status" id="updateStateResponseStatus">
                                        <span class="status-dot pending"></span>
                                        <span>Waiting...</span>
                                    </div>
                                    <button class="btn btn-secondary text-sm" onclick="copyUpdateStateResponse()">Copy</button>
                                </div>
                                <div class="response-body">
                                    <pre id="updateStateResponseJson"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- UPLOAD DOCUMENT PAGE -->
        <!-- ============================================ -->
        <div class="page-view" id="page-upload">
            <div class="main-grid">
                <div class="form-column">
                    <!-- Step 1: Select Verification -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-icon">1Ô∏è‚É£</div>
                            <h2 class="card-title">Select Verification</h2>
                        </div>

                        <div class="form-grid cols-1">
                            <div class="form-group">
                                <label>Select Saved Verification</label>
                                <select id="upload_verification_select" onchange="selectVerification('upload')">
                                    <option value="">-- Or enter ID manually below --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Verification ID <span class="required">*</span></label>
                                <input type="text" id="upload_verification_id" placeholder="KV-570b7da3-7f1a-4d48-b21d-74972732bb9e">
                            </div>
                        </div>

                        <div class="actions-bar">
                            <button class="btn btn-secondary btn-block" onclick="fetchDocumentsForUpload()">
                                <span class="btn-text">üìÑ Fetch Required Documents</span>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Required Documents List -->
                    <div class="card mb-4" id="documentsListCard" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon">2Ô∏è‚É£</div>
                            <h2 class="card-title">Required Documents</h2>
                            <span class="badge badge-info" id="docsCount">0 docs</span>
                        </div>

                        <div id="documentsList" class="documents-list">
                            <!-- Documents will be populated here -->
                        </div>
                    </div>

                    <!-- Step 3: Upload Selected Document -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">3Ô∏è‚É£</div>
                            <h2 class="card-title">Upload Document</h2>
                        </div>

                        <div class="form-grid cols-1">
                            <div class="form-group">
                                <label>Selected Document ID <span class="required">*</span></label>
                                <input type="text" id="upload_document_id" placeholder="Click a document above or enter ID" readonly>
                            </div>
                            <div class="form-group">
                                <label>Document Type</label>
                                <input type="text" id="upload_document_type" readonly class="text-muted">
                            </div>
                            <div class="form-group">
                                <label>Document File <span class="required">*</span></label>
                                <div class="file-upload" id="fileUploadArea">
                                    <input type="file" id="upload_file" accept="image/*,.pdf" onchange="handleFileSelect(this)">
                                    <div class="file-upload-icon">üìÅ</div>
                                    <div class="file-upload-text">Click to select or drag & drop a file</div>
                                    <div class="file-upload-name" id="selectedFileName"></div>
                                </div>
                            </div>
                        </div>

                        <div class="actions-bar">
                            <button class="btn btn-primary btn-block" onclick="uploadDocument()">
                                <span class="btn-text">üì§ Upload Document</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="response-column">
                    <div class="card" style="position: sticky; top: 24px;">
                        <div class="card-header">
                            <div class="card-icon">üì°</div>
                            <h2 class="card-title">Response</h2>
                        </div>
                        <div class="response-panel">
                            <div class="empty-state" id="uploadEmptyState">
                                <div class="empty-state-icon">üì≠</div>
                                <div class="empty-state-text">Select a file and click Upload</div>
                            </div>
                            <div id="uploadResponseContent" style="display: none;">
                                <div class="response-header">
                                    <div class="response-status" id="uploadResponseStatus">
                                        <span class="status-dot pending"></span>
                                        <span>Waiting...</span>
                                    </div>
                                    <button class="btn btn-secondary text-sm" onclick="copyUploadResponse()">Copy</button>
                                </div>
                                <div class="response-body">
                                    <pre id="uploadResponseJson"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- ============================================ -->
        <!-- CREATE PAYMENT PAGE -->
        <!-- ============================================ -->
        <div class="page-view" id="page-payment">
            <div class="main-grid">
                <div class="form-column">
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-icon">üí∏</div>
                            <h2 class="card-title">Create Remittance Payment</h2>
                        </div>

                        <div class="info-box">
                            Create a payment using approved Remitter and Beneficiary. Both must have APPROVED status with a user_id.
                            <br><br>
                            <strong>Tip:</strong> Use "Get Details" to refresh verification status and fetch user_id after approval.
                        </div>

                        <div class="info-box" style="background: rgba(88, 101, 242, 0.1); border-color: var(--accent-primary); margin-top: 12px;" id="sandboxTestInfo">
                            <strong>üß™ Sandbox Testing</strong><br>
                            In Sandbox mode, control payment outcomes using the <strong>Description</strong> field:<br>
                            ‚Ä¢ <strong>"200"</strong> = PAID (approved)<br>
                            ‚Ä¢ <strong>"300"</strong> = REJECTED (generic)<br>
                            ‚Ä¢ <strong>"302"</strong> = REJECTED (insufficient funds)<br>
                            <small style="color: var(--text-muted); display: block; margin-top: 8px;">
                                Quick test buttons available in Payment Details section below.
                            </small>
                        </div>

                        <!-- Remitter Selection -->
                        <div class="section open mt-4">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üë§ Select Remitter</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div id="remittersList" class="documents-list">
                                        <div class="no-documents">Loading approved remitters...</div>
                                    </div>
                                    <div class="form-grid cols-1 mt-3">
                                        <div class="form-group">
                                            <label>Selected Remitter User ID</label>
                                            <input type="text" id="payment_remitter_user_id" readonly placeholder="Select a remitter above">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Beneficiary Selection -->
                        <div class="section open">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üéØ Select Beneficiary</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div id="beneficiariesList" class="documents-list">
                                        <div class="no-documents">Loading approved beneficiaries...</div>
                                    </div>
                                    <div class="form-grid cols-1 mt-3">
                                        <div class="form-group">
                                            <label>Selected Beneficiary User ID</label>
                                            <input type="text" id="payment_beneficiary_user_id" readonly placeholder="Select a beneficiary above">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Details -->
                        <div class="section open">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üíµ Payment Details</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label>Payment Method <span class="required">*</span></label>
                                            <select id="payment_method" onchange="togglePaymentMethodFields()">
                                                <option value="IO" selected>Bank Transfer (IO)</option>
                                                <option value="CARD">Card (CARD)</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Country <span class="required">*</span></label>
                                            <select id="payment_country">
                                                <option value="AR" selected>Argentina (AR)</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Amount <span class="required">*</span></label>
                                            <input type="number" id="payment_amount" step="0.01" min="0" value="100" placeholder="100.00">
                                        </div>
                                        <div class="form-group">
                                            <label>Currency</label>
                                            <select id="payment_currency">
                                                <option value="ARS" selected>ARS</option>
                                                <option value="USD">USD</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>External Reference</label>
                                            <input type="text" id="payment_external_reference" placeholder="PAY-123456">
                                        </div>
                                        <div class="form-group">
                                            <label>Subpurpose <span class="required">*</span></label>
                                            <select id="payment_subpurpose">
                                                <option value="EPREFA">EPREFA - Family Allowance</option>
                                                <option value="EPREGS">EPREGS - Goods and Services</option>
                                                <option value="EPRETE">EPRETE - Travel Expenses</option>
                                                <option value="EPRESI">EPRESI - Savings or Investments</option>
                                                <option value="EPREGI">EPREGI - Gifts</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Source of Funds <span class="required">*</span></label>
                                            <select id="payment_source_of_funds">
                                                <option value="SAVINGS">SAVINGS</option>
                                                <option value="SALARY">SALARY</option>
                                                <option value="DONATION">DONATION</option>
                                                <option value="BUSINESS">BUSINESS</option>
                                                <option value="PENSION">PENSION</option>
                                                <option value="INHERITANCE">INHERITANCE</option>
                                                <option value="LOAN">LOAN</option>
                                            </select>
                                        </div>
                                        <div class="form-group full-width">
                                            <label>Description <span style="color: var(--text-muted); font-weight: normal; font-size: 12px;">(Controls sandbox test outcome)</span></label>
                                            <input type="text" id="payment_description" placeholder="Family support payment">
                                            <div id="sandboxTestButtons" style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;">
                                                <button type="button" class="btn btn-secondary text-sm" onclick="setTestDescription('200')" style="font-size: 11px; padding: 6px 12px;">
                                                    ‚úì Test Approved (200)
                                                </button>
                                                <button type="button" class="btn btn-secondary text-sm" onclick="setTestDescription('300')" style="font-size: 11px; padding: 6px 12px;">
                                                    ‚úó Test Rejected (300)
                                                </button>
                                                <button type="button" class="btn btn-secondary text-sm" onclick="setTestDescription('302')" style="font-size: 11px; padding: 6px 12px;">
                                                    üí∞ Test Insufficient Funds (302)
                                                </button>
                                            </div>
                                        </div>
                                        <div class="form-group full-width">
                                            <label>Notification URL</label>
                                            <input type="url" id="payment_notification_url" placeholder="https://dlocal-webhook.example.com.br" value="https://dlocal-webhook.example.com.br">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Card Fields (shown only when CARD is selected) -->
                        <div class="section" id="card_fields_section" style="display: none;">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üí≥ Card Information</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="info-box" style="margin-bottom: 16px;">
                                        <small><strong>Note:</strong> Direct card info uses <code>/secure_payments</code> endpoint. Tokens use <code>/payments</code> endpoint.</small>
                                    </div>
                                    <div class="form-grid">
                                        <div class="form-group full-width">
                                            <label>Card Token (from Smart Fields)</label>
                                            <input type="text" id="card_token" placeholder="CV-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                                        </div>
                                        <div class="form-group full-width" style="text-align: center; padding: 10px 0;">
                                            <span style="color: var(--text-muted);">‚Äî OR enter card details directly ‚Äî</span>
                                        </div>
                                        <div class="form-group">
                                            <label>Holder Name</label>
                                            <input type="text" id="card_holder_name" placeholder="Thiago Gabriel" value="Thiago Gabriel">
                                        </div>
                                        <div class="form-group">
                                            <label>Card Number <span style="color: var(--text-muted); font-weight: normal; font-size: 11px;">(4111111111111111 for test)</span></label>
                                            <input type="text" id="card_number" placeholder="4111111111111111" value="4111111111111111" maxlength="19">
                                        </div>
                                        <div class="form-group">
                                            <label>CVV</label>
                                            <input type="text" id="card_cvv" placeholder="123" value="123" maxlength="4">
                                        </div>
                                        <div class="form-group">
                                            <label>Expiration Month</label>
                                            <input type="number" id="card_exp_month" placeholder="10" value="10" min="1" max="12">
                                        </div>
                                        <div class="form-group">
                                            <label>Expiration Year</label>
                                            <input type="number" id="card_exp_year" placeholder="2040" value="2040" min="2024" max="2050">
                                        </div>
                                        <div class="form-group">
                                            <label>Capture</label>
                                            <select id="card_capture">
                                                <option value="true">Yes (Capture immediately)</option>
                                                <option value="false">No (Authorization only)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payer Info (auto-filled from remitter) -->
                        <div class="section">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üë§ Payer Info</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label>Payer Name</label>
                                            <input type="text" id="payment_payer_name" placeholder="John Doe" value="John Doe">
                                        </div>
                                        <div class="form-group">
                                            <label>Payer Email</label>
                                            <input type="email" id="payment_payer_email" placeholder="payer@example.com" value="payer@example.com">
                                        </div>
                                        <div class="form-group">
                                            <label>Payer Document</label>
                                            <input type="text" id="payment_payer_document" placeholder="53033315550" value="53033315550">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="actions-bar">
                            <button class="btn btn-secondary" onclick="loadPaymentParties()">
                                üîÑ Refresh Lists
                            </button>
                            <button class="btn btn-primary" style="flex: 2;" onclick="createPayment()">
                                <span class="btn-text">üí∏ Create Payment</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Response Panel -->
                <div class="response-column">
                    <div class="card" style="position: sticky; top: 24px;">
                        <div class="card-header">
                            <div class="card-icon">üì°</div>
                            <h2 class="card-title">Response</h2>
                        </div>
                        <div class="response-panel">
                            <div class="empty-state" id="paymentEmptyState">
                                <div class="empty-state-icon">üí≥</div>
                                <div class="empty-state-text">Select remitter & beneficiary, then create payment</div>
                            </div>
                            <div id="paymentResponseContent" style="display: none;">
                                <div class="response-header">
                                    <div class="response-status" id="paymentResponseStatus">
                                        <span class="status-dot pending"></span>
                                        <span>Waiting...</span>
                                    </div>
                                    <button class="btn btn-secondary text-sm" onclick="copyPaymentResponse()">Copy</button>
                                </div>
                                <div class="response-body">
                                    <pre id="paymentResponseJson"></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Summary Card -->
                        <div class="mt-4" id="paymentSummary" style="display: none;">
                            <div class="info-box" style="background: rgba(34, 197, 94, 0.1); border-color: rgba(34, 197, 94, 0.3); color: var(--success);">
                                <strong>Payment Summary</strong>
                                <div id="paymentSummaryContent" class="mt-3" style="font-size: 12px; color: var(--text-secondary);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- PAYOUTS PAGE -->
        <!-- ============================================ -->
        <div class="page-view" id="page-payouts">
            <div class="main-grid">
                <div class="form-column">
                    <div class="card mb-4">
                        <div class="card-header">
                            <div class="card-icon">üè¶</div>
                            <h2 class="card-title">Create Payout</h2>
                        </div>

                        <div class="info-box">
                            Create a payout (cashout) using dLocal Payouts API. This sends money to a beneficiary's bank account.
                            <br><br>
                            <strong>Note:</strong> Uses the API credentials configured above (Login, Transaction Key, Secret Key).
                        </div>

                        <!-- Remitter Selection -->
                        <div class="section open mt-4">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üë§ Select Remitter</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div id="payoutRemittersList" class="documents-list">
                                        <div class="no-documents">Loading approved remitters...</div>
                                    </div>
                                    <div class="form-grid cols-1 mt-3">
                                        <div class="form-group">
                                            <label>Selected Remitter User ID</label>
                                            <input type="text" id="payout_remitter_user_id" readonly placeholder="Select a remitter above">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Beneficiary Selection -->
                        <div class="section open">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üéØ Select Beneficiary</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div id="payoutBeneficiariesList" class="documents-list">
                                        <div class="no-documents">Loading approved beneficiaries...</div>
                                    </div>
                                    <div class="form-grid cols-1 mt-3">
                                        <div class="form-group">
                                            <label>Selected Beneficiary User ID</label>
                                            <input type="text" id="payout_beneficiary_user_id" readonly placeholder="Select a beneficiary above">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bank Details -->
                        <div class="section open">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üè¶ Bank Details</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label>Bank Code</label>
                                            <input type="text" id="payout_bank_code" placeholder="0" value="0">
                                        </div>
                                        <div class="form-group">
                                            <label>Bank Name <span class="required">*</span></label>
                                            <input type="text" id="payout_bank_name" placeholder="Billetera Virtual" value="Billetera Virtual">
                                        </div>
                                        <div class="form-group">
                                            <label>Bank Province</label>
                                            <input type="text" id="payout_bank_province" placeholder="Jujuy" value="Jujuy">
                                        </div>
                                        <div class="form-group">
                                            <label>Bank Account <span class="required">*</span></label>
                                            <input type="text" id="payout_bank_account" placeholder="0000076500000035601368" value="0000076500000035601368">
                                        </div>
                                        <div class="form-group">
                                            <label>Account Type</label>
                                            <select id="payout_account_type">
                                                <option value="C" selected>C - Checking</option>
                                                <option value="S">S - Savings</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payout Details -->
                        <div class="section open">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üíµ Payout Details</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label>External ID <span class="required">*</span></label>
                                            <input type="text" id="payout_external_id" placeholder="test-payout-001" value="test-remittance-validation-3">
                                        </div>
                                        <div class="form-group">
                                            <label>Country <span class="required">*</span></label>
                                            <select id="payout_country">
                                                <option value="AR" selected>Argentina (AR)</option>
                                                <option value="BR">Brazil (BR)</option>
                                                <option value="CL">Chile (CL)</option>
                                                <option value="CO">Colombia (CO)</option>
                                                <option value="MX">Mexico (MX)</option>
                                                <option value="PE">Peru (PE)</option>
                                                <option value="UY">Uruguay (UY)</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Amount <span class="required">*</span></label>
                                            <input type="text" id="payout_amount" placeholder="4000.00" value="4000.00">
                                        </div>
                                        <div class="form-group">
                                            <label>Currency</label>
                                            <select id="payout_currency">
                                                <option value="ARS" selected>ARS</option>
                                                <option value="BRL">BRL</option>
                                                <option value="CLP">CLP</option>
                                                <option value="COP">COP</option>
                                                <option value="MXN">MXN</option>
                                                <option value="PEN">PEN</option>
                                                <option value="USD">USD</option>
                                                <option value="UYU">UYU</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Purpose & Compliance -->
                        <div class="section open">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">‚öñÔ∏è Purpose & Compliance</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label>Purpose <span class="required">*</span></label>
                                            <select id="payout_purpose">
                                                <option value="EPREMT" selected>EPREMT - Remittance Transfer</option>
                                                <option value="EPRESE">EPRESE - Salary/Employment</option>
                                                <option value="EPREPD">EPREPD - Payment for Services</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Subpurpose <span class="required">*</span></label>
                                            <select id="payout_subpurpose">
                                                <option value="EPREFA" selected>EPREFA - Family Allowance</option>
                                                <option value="EPREGS">EPREGS - Goods and Services</option>
                                                <option value="EPRETE">EPRETE - Travel Expenses</option>
                                                <option value="EPRESI">EPRESI - Savings or Investments</option>
                                                <option value="EPREGI">EPREGI - Gifts</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Source of Funds <span class="required">*</span></label>
                                            <select id="payout_source_of_funds">
                                                <option value="SAVINGS" selected>SAVINGS</option>
                                                <option value="SALARY">SALARY</option>
                                                <option value="DONATION">DONATION</option>
                                                <option value="BUSINESS">BUSINESS</option>
                                                <option value="PENSION">PENSION</option>
                                                <option value="INHERITANCE">INHERITANCE</option>
                                                <option value="LOAN">LOAN</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Optional Fields -->
                        <div class="section">
                            <div class="section-header" onclick="toggleSection(this)">
                                <span class="section-title">üìù Optional Fields</span>
                                <span class="section-arrow">‚ñº</span>
                            </div>
                            <div class="section-content">
                                <div class="section-body">
                                    <div class="form-grid">
                                        <div class="form-group full-width">
                                            <label>Notification URL</label>
                                            <input type="url" id="payout_notification_url" placeholder="https://dlocal-webhook.example.com.br" value="https://dlocal-webhook.example.com.br">
                                        </div>
                                        <div class="form-group">
                                            <label>Beneficiary Name</label>
                                            <input type="text" id="payout_beneficiary_name" placeholder="John Doe">
                                        </div>
                                        <div class="form-group">
                                            <label>Beneficiary Document</label>
                                            <input type="text" id="payout_beneficiary_document" placeholder="12345678">
                                        </div>
                                        <div class="form-group">
                                            <label>Beneficiary Document Type</label>
                                            <select id="payout_beneficiary_document_type">
                                                <option value="">Select...</option>
                                                <option value="DNI">DNI</option>
                                                <option value="CUIT">CUIT</option>
                                                <option value="CUIL">CUIL</option>
                                                <option value="CPF">CPF</option>
                                                <option value="CNPJ">CNPJ</option>
                                                <option value="RUT">RUT</option>
                                                <option value="CC">CC</option>
                                                <option value="CE">CE</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="actions-bar">
                            <button class="btn btn-secondary" onclick="loadPayoutParties()">
                                üîÑ Refresh Lists
                            </button>
                            <button class="btn btn-primary" style="flex: 2;" onclick="createPayout()">
                                <span class="btn-text">üè¶ Create Payout</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Response Panel -->
                <div class="response-column">
                    <div class="card" style="position: sticky; top: 24px;">
                        <div class="card-header">
                            <div class="card-icon">üì°</div>
                            <h2 class="card-title">Response</h2>
                        </div>
                        <div class="response-panel">
                            <div class="empty-state" id="payoutEmptyState">
                                <div class="empty-state-icon">üè¶</div>
                                <div class="empty-state-text">Select remitter & beneficiary, then create payout</div>
                            </div>
                            <div id="payoutResponseContent" style="display: none;">
                                <div class="response-header">
                                    <div class="response-status" id="payoutResponseStatus">
                                        <span class="status-dot pending"></span>
                                        <span>Waiting...</span>
                                    </div>
                                    <button class="btn btn-secondary text-sm" onclick="copyPayoutResponse()">Copy</button>
                                </div>
                                <div class="response-body">
                                    <pre id="payoutResponseJson"></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Request Preview -->
                        <div class="mt-4">
                            <div class="info-box" style="background: rgba(88, 101, 242, 0.1); border-color: rgba(88, 101, 242, 0.3);">
                                <strong style="color: var(--accent-primary);">Request Preview</strong>
                                <pre id="payoutRequestPreview" class="mt-3" style="font-size: 11px; color: var(--text-secondary); overflow-x: auto; white-space: pre-wrap;"></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- PAYMENT STATUS PAGE -->
        <!-- ============================================ -->
        <div class="page-view" id="page-payment-status">
            <div class="main-grid">
                <div class="form-column">
                    <!-- Select Payment -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üí≥</div>
                            <h2 class="card-title">Select Payment</h2>
                        </div>

                        <div class="form-grid cols-1">
                            <div class="form-group">
                                <label>Saved Payments</label>
                                <select id="payment_status_payment_select" onchange="selectPayment('payment_status')">
                                    <option value="">-- Select a payment --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Payment ID <span class="required">*</span></label>
                                <input type="text" id="payment_status_payment_id" placeholder="PAY-xxxxx-xxxx-xxxx-xxxxx">
                            </div>
                        </div>

                        <button class="btn btn-primary w-full" onclick="getPaymentStatus()">
                            <span>üîç Get Payment Status</span>
                        </button>
                    </div>

                    <!-- Info Box -->
                    <div class="info-box mt-4">
                        <strong>üìä Payment Status Information</strong>
                        <p class="mt-2">Retrieve detailed payment information including:</p>
                        <ul style="margin-top: 8px; padding-left: 20px;">
                            <li>Payment status and status details</li>
                            <li>Transaction amounts and currency</li>
                            <li>Payment method information</li>
                            <li>Payer and card details</li>
                            <li>Creation and update timestamps</li>
                            <li>Risk and fraud detection information</li>
                        </ul>
                        <p class="mt-2" style="font-size: 12px; color: var(--text-muted);">
                            The status is automatically refreshed each time you fetch payment details.
                        </p>
                    </div>
                </div>

                <!-- Response Panel -->
                <div class="response-column">
                    <div class="card" style="position: sticky; top: 24px;">
                        <div class="card-header">
                            <div class="card-icon">üì°</div>
                            <h2 class="card-title">Payment Details</h2>
                        </div>
                        <div class="response-panel">
                            <div class="empty-state" id="paymentStatusEmptyState">
                                <div class="empty-state-icon">üí≥</div>
                                <div class="empty-state-text">Select a payment and click "Get Payment Status"</div>
                            </div>
                            <div id="paymentStatusContent" style="display: none;">
                                <div class="response-header">
                                    <div class="response-status" id="paymentStatusResponseStatus">
                                        <span class="status-dot pending"></span>
                                        <span>Waiting...</span>
                                    </div>
                                    <button class="btn btn-secondary text-sm" onclick="copyPaymentStatus()">Copy JSON</button>
                                </div>
                                
                                <!-- Payment Status Summary -->
                                <div id="paymentStatusSummary" style="margin-bottom: 20px; padding: 16px; background: var(--bg-secondary); border-radius: 8px;"></div>
                                
                                <!-- Full JSON Response -->
                                <div class="response-body">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                        <strong style="color: var(--text-primary); font-size: 13px;">Full Response:</strong>
                                        <button class="btn btn-secondary text-sm" onclick="togglePaymentJson()">
                                            <span id="togglePaymentJsonText">Show JSON</span>
                                        </button>
                                    </div>
                                    <pre id="paymentStatusJson" style="display: none;"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- DOCS PAGE -->
        <!-- ============================================ -->
        <div class="page-view" id="page-docs">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">üìö</div>
                    <h2 class="card-title">Documentation</h2>
                </div>

                <!-- Docs Sub-tabs -->
                <div class="docs-tabs" style="display: flex; gap: 4px; background: var(--bg-secondary); padding: 4px; border-radius: var(--radius-md); margin-bottom: 20px;">
                    <button class="docs-tab active" data-docs-tab="tech-doc" onclick="switchDocsTab('tech-doc')">üìñ Technical Documentation</button>
                    <button class="docs-tab" data-docs-tab="api-workflow" onclick="switchDocsTab('api-workflow')">üîÑ APIs & Workflow</button>
                </div>

                <!-- Tech Doc Tab Content -->
                <div class="docs-content active" id="docs-tech-doc">
                    <div class="docs-section">
                        <h3 class="docs-title">üèóÔ∏è Architecture</h3>
                        <div class="docs-body">
                            <pre class="code-block">kyc-verification/
‚îú‚îÄ‚îÄ app.py                    # Flask application (backend)
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ index.html            # Single-page application (frontend)
‚îú‚îÄ‚îÄ instance/
‚îÇ   ‚îî‚îÄ‚îÄ kyc_verifications.db  # SQLite database
‚îú‚îÄ‚îÄ venv/                     # Python virtual environment
‚îî‚îÄ‚îÄ requirements.txt          # Python dependencies</pre>
                            
                            <h4>Tech Stack</h4>
                            <ul class="docs-list">
                                <li><strong>Backend:</strong> Flask, Flask-SQLAlchemy</li>
                                <li><strong>Database:</strong> SQLite</li>
                                <li><strong>Frontend:</strong> Vanilla JavaScript, HTML5, CSS3</li>
                                <li><strong>HTTP Client:</strong> Python Requests library</li>
                            </ul>
                        </div>
                    </div>

                    <div class="docs-section">
                        <h3 class="docs-title">üîê Authentication</h3>
                        <div class="docs-body">
                            <h4>KYC & Payments API (HMAC-SHA256)</h4>
                            <pre class="code-block"># Signature generation
message = f"{login}{date_str}{body_json}"
signature = hmac.new(secret_key, message, hashlib.sha256).hexdigest()

# Headers
headers = {
    "X-Date": "2026-01-08T15:00:00.000Z",
    "X-Login": "&lt;login&gt;",
    "X-Trans-Key": "&lt;transaction_key&gt;",
    "Authorization": "V2-HMAC-SHA256, Signature: &lt;signature&gt;"
}</pre>

                            <h4>Payouts API (Payload Signature)</h4>
                            <pre class="code-block"># Signature generation (payload only)
payload_signature = hmac.new(secret_key, body_json, hashlib.sha256).hexdigest()

# Headers
headers = {
    "X-Date": "Thu, 08 Jan 2026 15:00:00 GMT",
    "X-Login": "&lt;login&gt;",
    "X-Trans-Key": "&lt;transaction_key&gt;",
    "payload-signature": "&lt;payload_signature&gt;",
    "Content-Type": "application/json"
}

# Body includes
{
    "login": "&lt;login&gt;",
    "pass": "&lt;transaction_key&gt;",
    "signature": true,
    ...
}</pre>
                        </div>
                    </div>

                    <div class="docs-section">
                        <h3 class="docs-title">üóÑÔ∏è Database Models</h3>
                        <div class="docs-body">
                            <h4>Verification Model</h4>
                            <table class="docs-table">
                                <thead>
                                    <tr><th>Field</th><th>Type</th><th>Description</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>id</td><td>Integer</td><td>Primary key</td></tr>
                                    <tr><td>verification_id</td><td>String</td><td>dLocal verification ID (unique)</td></tr>
                                    <tr><td>user_id</td><td>String</td><td>User ID returned when approved</td></tr>
                                    <tr><td>client_type</td><td>String</td><td>REMITTER or BENEFICIARY</td></tr>
                                    <tr><td>first_name</td><td>String</td><td>Client first name</td></tr>
                                    <tr><td>last_name</td><td>String</td><td>Client last name</td></tr>
                                    <tr><td>status</td><td>String</td><td>CREATED, PENDING, APPROVED, REJECTED</td></tr>
                                    <tr><td>environment</td><td>String</td><td>sandbox or production</td></tr>
                                </tbody>
                            </table>

                            <h4>Document Model</h4>
                            <table class="docs-table">
                                <thead>
                                    <tr><th>Field</th><th>Type</th><th>Description</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>id</td><td>Integer</td><td>Primary key</td></tr>
                                    <tr><td>verification_id</td><td>String</td><td>Associated verification ID</td></tr>
                                    <tr><td>document_id</td><td>String</td><td>dLocal document ID</td></tr>
                                    <tr><td>document_type</td><td>String</td><td>Document type</td></tr>
                                    <tr><td>status</td><td>String</td><td>PENDING, UPLOADED, APPROVED</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="docs-section">
                        <h3 class="docs-title">üìã Purpose & Subpurpose Codes</h3>
                        <div class="docs-body">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <h4>Purpose Codes</h4>
                                    <table class="docs-table">
                                        <thead><tr><th>Code</th><th>Description</th></tr></thead>
                                        <tbody>
                                            <tr><td>EPREMT</td><td>Remittance Transfer</td></tr>
                                            <tr><td>EPRESE</td><td>Salary/Employment</td></tr>
                                            <tr><td>EPREPD</td><td>Payment for Services</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div>
                                    <h4>Subpurpose Codes</h4>
                                    <table class="docs-table">
                                        <thead><tr><th>Code</th><th>Description</th></tr></thead>
                                        <tbody>
                                            <tr><td>EPREFA</td><td>Family Allowance</td></tr>
                                            <tr><td>EPREGS</td><td>Goods and Services</td></tr>
                                            <tr><td>EPRETE</td><td>Travel Expenses</td></tr>
                                            <tr><td>EPRESI</td><td>Savings or Investments</td></tr>
                                            <tr><td>EPREGI</td><td>Gifts</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <h4 style="margin-top: 16px;">Source of Funds</h4>
                            <div class="docs-chips">
                                <span class="chip">SAVINGS</span>
                                <span class="chip">SALARY</span>
                                <span class="chip">DONATION</span>
                                <span class="chip">BUSINESS</span>
                                <span class="chip">PENSION</span>
                                <span class="chip">INHERITANCE</span>
                                <span class="chip">LOAN</span>
                            </div>
                        </div>
                    </div>

                    <div class="docs-section">
                        <h3 class="docs-title">‚ö†Ô∏è Error Handling</h3>
                        <div class="docs-body">
                            <table class="docs-table">
                                <thead><tr><th>Code</th><th>Description</th><th>Solution</th></tr></thead>
                                <tbody>
                                    <tr><td>301</td><td>Empty param control</td><td>Check all required fields are populated</td></tr>
                                    <tr><td>401</td><td>Unauthorized</td><td>Verify credentials and signature</td></tr>
                                    <tr><td>404</td><td>Not found</td><td>Resource doesn't exist</td></tr>
                                    <tr><td>5300</td><td>Invalid signature</td><td>Check signature calculation</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- API Workflow Tab Content -->
                <div class="docs-content" id="docs-api-workflow">
                    <div class="docs-section">
                        <h3 class="docs-title">üîÑ Complete Remittance Workflow</h3>
                        <div class="docs-body">
                            <div class="workflow-diagram">
                                <div class="workflow-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h4>Create Remitter KYC</h4>
                                        <p>Create verification for the sender</p>
                                        <code>POST /kyc/verifications</code>
                                    </div>
                                </div>
                                <div class="workflow-arrow">‚Üí</div>
                                <div class="workflow-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h4>Upload Documents</h4>
                                        <p>Submit required identity documents</p>
                                        <code>PATCH /kyc/verifications/{id}/documents/{doc_id}</code>
                                    </div>
                                </div>
                                <div class="workflow-arrow">‚Üí</div>
                                <div class="workflow-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <h4>Wait for Approval</h4>
                                        <p>Status changes to APPROVED</p>
                                        <code>GET /kyc/verifications/{id}</code>
                                    </div>
                                </div>
                                <div class="workflow-arrow">‚Üí</div>
                                <div class="workflow-step">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <h4>Create Beneficiary KYC</h4>
                                        <p>Create verification for the receiver</p>
                                        <code>POST /kyc/verifications</code>
                                    </div>
                                </div>
                                <div class="workflow-arrow">‚Üí</div>
                                <div class="workflow-step">
                                    <div class="step-number">5</div>
                                    <div class="step-content">
                                        <h4>Create Payment/Payout</h4>
                                        <p>Execute the money transfer</p>
                                        <code>POST /payments</code> or <code>POST /api_curl/cashout_api/request_cashout</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="docs-section">
                        <h3 class="docs-title">üì° API Endpoints Reference</h3>
                        <div class="docs-body">
                            <h4>Base URLs</h4>
                            <table class="docs-table">
                                <thead><tr><th>Environment</th><th>URL</th></tr></thead>
                                <tbody>
                                    <tr><td>Sandbox</td><td><code>https://sandbox.dlocal.com</code></td></tr>
                                    <tr><td>Production</td><td><code>https://api.dlocal.com</code></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="docs-section">
                        <h3 class="docs-title">üìù KYC Verifications API</h3>
                        <div class="docs-body">
                            <div class="api-endpoint">
                                <div class="api-method post">POST</div>
                                <div class="api-path">/kyc/verifications</div>
                                <div class="api-desc">Create new verification</div>
                            </div>
                            <pre class="code-block">{
    "type": "REMITTANCE",
    "notification_url": "https://dlocal-webhook.example.com.br",
    "attributes": {
        "external_reference": "REF-123",
        "client": {
            "type": "REMITTER",  // or "BENEFICIARY"
            "first_name": "John",
            "last_name": "Doe",
            "document_type": "TAX_ID",
            "document_number": "12345678",
            "document_country": "US",
            "date_of_birth": "1990-01-01",
            "nationality": "US",
            "phone": "+1234567890",
            "email": "john@example.com",
            "address": {
                "country": "US",
                "city": "New York",
                "state": "NY",
                "zip_code": "10001",
                "street_name": "Main St",
                "street_number": "123"
            }
        }
    }
}</pre>

                            <div class="api-endpoint">
                                <div class="api-method get">GET</div>
                                <div class="api-path">/kyc/verifications/{id}?include=client_data</div>
                                <div class="api-desc">Get verification details</div>
                            </div>

                            <div class="api-endpoint">
                                <div class="api-method get">GET</div>
                                <div class="api-path">/kyc/verifications/{id}/documents</div>
                                <div class="api-desc">List required documents</div>
                            </div>

                            <div class="api-endpoint">
                                <div class="api-method patch">PATCH</div>
                                <div class="api-path">/kyc/verifications/{id}/documents/{doc_id}</div>
                                <div class="api-desc">Upload document (multipart/form-data)</div>
                            </div>
                        </div>
                    </div>

                    <div class="docs-section">
                        <h3 class="docs-title">üí∏ Payments API (Payins)</h3>
                        <div class="docs-body">
                            <div class="api-endpoint">
                                <div class="api-method post">POST</div>
                                <div class="api-path">/payments</div>
                                <div class="api-desc">Create remittance payment</div>
                            </div>
                            <pre class="code-block">{
    "amount": 100.00,
    "currency": "ARS",
    "country": "AR",
    "payment_method_id": "IO",
    "payment_method_flow": "DIRECT",
    "payer": {
        "name": "John Doe",
        "email": "john@example.com",
        "document": "12345678"
    },
    "order_id": "PAY-123456",
    "remitter_user_id": "KV-xxxxx-xxxx-xxxx",
    "beneficiary_user_id": "KV-xxxxx-xxxx-xxxx",
    "subpurpose": "EPREFA",
    "source_of_funds": "SAVINGS",
    "signature": true
}</pre>
                        </div>
                    </div>

                    <div class="docs-section">
                        <h3 class="docs-title">üè¶ Payouts API (Cashouts)</h3>
                        <div class="docs-body">
                            <div class="api-endpoint">
                                <div class="api-method post">POST</div>
                                <div class="api-path">/api_curl/cashout_api/request_cashout</div>
                                <div class="api-desc">Create payout</div>
                            </div>
                            <pre class="code-block">{
    "login": "&lt;login&gt;",
    "pass": "&lt;transaction_key&gt;",
    "external_id": "PAYOUT-123",
    "country": "AR",
    "bank_code": "0",
    "bank_name": "Billetera Virtual",
    "bank_province": "Jujuy",
    "bank_account": "0000076500000035601368",
    "account_type": "C",
    "amount": "4000.00",
    "currency": "ARS",
    "purpose": "EPREMT",
    "remitter_user_id": "KV-xxxxx-xxxx-xxxx",
    "beneficiary_user_id": "KV-xxxxx-xxxx-xxxx",
    "subpurpose": "EPREFA",
    "source_of_funds": "SAVINGS",
    "signature": true
}</pre>

                            <h4>Required Headers</h4>
                            <table class="docs-table">
                                <thead><tr><th>Header</th><th>Value</th></tr></thead>
                                <tbody>
                                    <tr><td>X-Date</td><td>RFC 2822 timestamp</td></tr>
                                    <tr><td>X-Login</td><td>API Login</td></tr>
                                    <tr><td>X-Trans-Key</td><td>Transaction Key</td></tr>
                                    <tr><td>payload-signature</td><td>HMAC-SHA256 of JSON body</td></tr>
                                    <tr><td>Content-Type</td><td>application/json</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="docs-section">
                        <h3 class="docs-title">üîó Local API Endpoints</h3>
                        <div class="docs-body">
                            <table class="docs-table">
                                <thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead>
                                <tbody>
                                    <tr><td><span class="method-badge get">GET</span></td><td>/api/local/verifications</td><td>List all saved verifications</td></tr>
                                    <tr><td><span class="method-badge delete">DEL</span></td><td>/api/local/verifications/{id}</td><td>Delete verification</td></tr>
                                    <tr><td><span class="method-badge get">GET</span></td><td>/api/local/remitters/approved</td><td>Get approved remitters</td></tr>
                                    <tr><td><span class="method-badge get">GET</span></td><td>/api/local/beneficiaries/approved</td><td>Get approved beneficiaries</td></tr>
                                    <tr><td><span class="method-badge get">GET</span></td><td>/api/local/payments</td><td>List all saved payments</td></tr>
                                    <tr><td><span class="method-badge delete">DEL</span></td><td>/api/local/payments/{id}</td><td>Delete payment</td></tr>
                                    <tr><td><span class="method-badge post">POST</span></td><td>/api/verifications</td><td>Create verification (proxy to dLocal)</td></tr>
                                    <tr><td><span class="method-badge post">POST</span></td><td>/api/payments</td><td>Create payment (proxy to dLocal)</td></tr>
                                    <tr><td><span class="method-badge post">POST</span></td><td>/api/payments/{id}</td><td>Get payment details (proxy to dLocal)</td></tr>
                                    <tr><td><span class="method-badge post">POST</span></td><td>/api/payouts</td><td>Create payout (proxy to dLocal)</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Profile Modal -->
    <div class="modal-overlay" id="saveModal">
        <div class="modal">
            <h3 class="modal-title">Save Credentials Profile</h3>
            <div class="form-group">
                <label>Profile Name <span class="required">*</span></label>
                <input type="text" id="profileName" placeholder="e.g., My Sandbox Account">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveProfile()">Save</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ============================================
        // SAVED VERIFICATIONS MANAGEMENT
        // ============================================
        let savedVerifications = [];
        let savedDocuments = {};

        async function loadSavedVerifications() {
            try {
                const response = await fetch('/api/local/verifications');
                savedVerifications = await response.json();
                populateVerificationDropdowns();
            } catch (error) {
                console.error('Error loading verifications:', error);
            }
        }

        // ============================================
        // OVERVIEW PAGE FUNCTIONS
        // ============================================
        async function loadOverview() {
            const content = document.getElementById('overview-content');
            content.innerHTML = '<div class="overview-loading" style="text-align: center; padding: 40px; color: var(--text-muted);">Loading verifications...</div>';

            try {
                const response = await fetch('/api/local/verifications');
                const verifications = await response.json();

                if (!verifications || verifications.length === 0) {
                    content.innerHTML = `
                        <div class="overview-empty">
                            <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
                            <div style="font-size: 16px; margin-bottom: 8px;">No verifications yet</div>
                            <div style="font-size: 13px;">Create a Remitter or Beneficiary to get started</div>
                        </div>`;
                    return;
                }

                const remitters = verifications.filter(v => v.client_type === 'REMITTER');
                const beneficiaries = verifications.filter(v => v.client_type === 'BENEFICIARY');

                const stats = {
                    total: verifications.length,
                    remitters: remitters.length,
                    beneficiaries: beneficiaries.length,
                    approved: verifications.filter(v => v.status === 'APPROVED').length,
                    pending: verifications.filter(v => v.status === 'PENDING' || v.status === 'CREATED').length,
                    rejected: verifications.filter(v => v.status === 'REJECTED').length
                };

                content.innerHTML = `
                    <div class="overview-stats">
                        <div class="stat-card">
                            <div class="stat-value">${stats.total}</div>
                            <div class="stat-label">Total Verifications</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #3b82f6;">${stats.remitters}</div>
                            <div class="stat-label">Remitters</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #8b5cf6;">${stats.beneficiaries}</div>
                            <div class="stat-label">Beneficiaries</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #10b981;">${stats.approved}</div>
                            <div class="stat-label">Approved</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #f59e0b;">${stats.pending}</div>
                            <div class="stat-label">Pending</div>
                        </div>
                    </div>

                    <div class="overview-grid">
                        <div class="overview-section">
                            <div class="overview-section-title">
                                <span>üë§</span> Remitters (${remitters.length})
                            </div>
                            ${renderVerificationTable(remitters, 'REMITTER')}
                        </div>

                        <div class="overview-section">
                            <div class="overview-section-title">
                                <span>üè¶</span> Beneficiaries (${beneficiaries.length})
                            </div>
                            ${renderVerificationTable(beneficiaries, 'BENEFICIARY')}
                        </div>
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `
                    <div class="overview-empty" style="color: var(--error);">
                        <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>
                        <div>Error loading verifications: ${error.message}</div>
                    </div>`;
            }
        }

        function renderVerificationTable(verifications, type) {
            if (!verifications || verifications.length === 0) {
                return `<div class="overview-empty" style="padding: 20px;">No ${type.toLowerCase()}s created yet</div>`;
            }

            return `
                <table class="overview-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Document</th>
                            <th>Status</th>
                            <th>Missing</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${verifications.map(v => `
                            <tr>
                                <td>
                                    <div style="font-weight: 500; color: var(--text-primary);">${v.first_name} ${v.last_name}</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">${v.verification_id.substring(0, 25)}...</div>
                                </td>
                                <td>${v.document_number || '-'}</td>
                                <td>${renderStatusChip(v.status)}</td>
                                <td id="missing-${v.verification_id}">
                                    <span class="missing-item" style="background: rgba(107, 114, 128, 0.1); color: #6b7280;">Loading...</span>
                                </td>
                                <td>
                                    <div class="action-btns">
                                        <button class="action-btn" onclick="fetchVerificationStatus('${v.verification_id}')" title="Refresh Status">üîÑ</button>
                                        <button class="action-btn" onclick="viewVerificationDocs('${v.verification_id}')" title="View Documents">üìÑ</button>
                                        <button class="action-btn" onclick="deleteLocalVerification('${v.verification_id}')" title="Delete">üóëÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderStatusChip(status) {
            const statusClass = {
                'APPROVED': 'status-approved',
                'PENDING': 'status-pending',
                'REJECTED': 'status-rejected',
                'CREATED': 'status-created',
                'PAID': 'status-paid',
            }[status] || 'status-unknown';

            const statusIcon = {
                'APPROVED': '‚úì',
                'PENDING': '‚è≥',
                'REJECTED': '‚úó',
                'CREATED': 'üìù',
                'PAID': '‚úì'
            }[status] || '?';

            return `<span class="status-chip ${statusClass}">${statusIcon} ${status || 'Unknown'}</span>`;
        }

        async function fetchVerificationStatus(verificationId) {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const missingCell = document.getElementById(`missing-${verificationId}`);
            if (missingCell) {
                missingCell.innerHTML = '<span class="missing-item" style="background: rgba(107, 114, 128, 0.1); color: #6b7280;">Fetching...</span>';
            }

            try {
                // Get verification details
                const response = await fetch(`/api/verifications/${verificationId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        use_sandbox: useSandbox(),
                        include_client_data: true
                    })
                });
                const result = await response.json();

                // Get required documents
                const docsResponse = await fetch(`/api/verifications/${verificationId}/documents`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        use_sandbox: useSandbox()
                    })
                });
                const docsResult = await docsResponse.json();

                // Update missing documents cell
                if (missingCell && docsResult.response) {
                    const docs = Array.isArray(docsResult.response) ? docsResult.response : [];
                    const missingDocs = docs.filter(d => d.status === 'PENDING' || d.status === 'REQUIRED');
                    
                    if (missingDocs.length === 0) {
                        missingCell.innerHTML = '<span class="complete-badge">‚úì All documents uploaded</span>';
                    } else {
                        missingCell.innerHTML = `
                            <div class="missing-list">
                                ${missingDocs.map(d => `<span class="missing-item">${d.document_type || d.type}</span>`).join('')}
                            </div>
                        `;
                    }
                }

                // Reload the overview to show updated status
                await loadSavedVerifications();
                showToast('success', 'Status refreshed');
            } catch (error) {
                showToast('error', 'Failed to fetch status');
                if (missingCell) {
                    missingCell.innerHTML = '<span class="missing-item">Error loading</span>';
                }
            }
        }

        function viewVerificationDocs(verificationId) {
            // Switch to documents tab and pre-select the verification
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelector('[data-page="documents"]').classList.add('active');
            document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active'));
            document.getElementById('page-documents').classList.add('active');
            
            document.getElementById('docs_verification_select').value = verificationId;
            document.getElementById('docs_verification_id').value = verificationId;
        }

        async function deleteLocalVerification(verificationId) {
            if (!confirm('Delete this verification from local storage?')) return;

            try {
                await fetch(`/api/local/verifications/${verificationId}`, { method: 'DELETE' });
                showToast('success', 'Verification deleted');
                loadOverview();
                loadSavedVerifications();
            } catch (error) {
                showToast('error', 'Failed to delete');
            }
        }

        async function refreshOverview() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) {
                showToast('error', 'Enter credentials to refresh statuses');
                loadOverview();
                return;
            }

            showToast('info', 'Refreshing all verifications...');
            
            // Load overview first
            await loadOverview();
            
            // Then fetch status for each verification
            for (const v of savedVerifications) {
                await fetchVerificationStatus(v.verification_id);
                await new Promise(r => setTimeout(r, 300)); // Small delay between requests
            }

            loadOverview();
            showToast('success', 'All verifications refreshed');
        }

        // ============================================
        // PAYMENTS OVERVIEW FUNCTIONS
        // ============================================
        async function loadPaymentsOverview() {
            const content = document.getElementById('payments-overview-content');
            content.innerHTML = '<div class="payments-loading" style="text-align: center; padding: 40px; color: var(--text-muted);">Loading payments...</div>';

            try {
                const response = await fetch('/api/local/payments');
                const payments = await response.json();

                if (!payments || payments.length === 0) {
                    content.innerHTML = `
                        <div class="overview-empty">
                            <div style="font-size: 48px; margin-bottom: 16px;">üí≥</div>
                            <div style="font-size: 16px; margin-bottom: 8px;">No payments yet</div>
                            <div style="font-size: 13px;">Create a payment to get started</div>
                        </div>`;
                    return;
                }

                const stats = {
                    total: payments.length,
                    paid: payments.filter(p => p.status === 'PAID').length,
                    pending: payments.filter(p => p.status === 'PENDING').length,
                    rejected: payments.filter(p => p.status === 'REJECTED').length,
                    totalAmount: payments.filter(p => p.status === 'PAID').reduce((sum, p) => sum + (p.amount || 0), 0)
                };

                content.innerHTML = `
                    <div class="overview-stats">
                        <div class="stat-card">
                            <div class="stat-value">${stats.total}</div>
                            <div class="stat-label">Total Payments</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #10b981;">${stats.paid}</div>
                            <div class="stat-label">Paid</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #f59e0b;">${stats.pending}</div>
                            <div class="stat-label">Pending</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #ef4444;">${stats.rejected}</div>
                            <div class="stat-label">Rejected</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.totalAmount.toFixed(2)}</div>
                            <div class="stat-label">Total Paid Amount</div>
                        </div>
                    </div>

                    <div class="overview-section">
                        <div class="overview-section-title">
                            <span>üí∞</span> Recent Payments (${payments.length})
                        </div>
                        ${renderPaymentsTable(payments)}
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `
                    <div class="overview-empty" style="color: var(--error);">
                        <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>
                        <div>Error loading payments: ${error.message}</div>
                    </div>`;
            }
        }

        function renderPaymentsTable(payments) {
            if (!payments || payments.length === 0) {
                return `<div class="overview-empty" style="padding: 20px;">No payments created yet</div>`;
            }

            return `
                <table class="overview-table">
                    <thead>
                        <tr>
                            <th>Payment ID</th>
                            <th>Order ID</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${payments.map(p => `
                            <tr>
                                <td>
                                    <div style="font-weight: 500; color: var(--text-primary);">${p.payment_id.substring(0, 20)}...</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">${p.environment}</div>
                                </td>
                                <td style="font-size: 12px; color: var(--text-secondary);">${p.order_id || 'N/A'}</td>
                                <td>
                                    <div style="font-weight: 500;">${p.currency} ${p.amount}</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">${p.country}</div>
                                </td>
                                <td style="font-size: 12px;">${p.payment_method_id}</td>
                                <td>${renderStatusChip(p.status)}</td>
                                <td>
                                    <div class="action-btns">
                                        <button class="action-btn" onclick="refreshPaymentStatus('${p.payment_id}')" title="Refresh">üîÑ</button>
                                        <button class="action-btn" onclick="deleteLocalPayment(${p.id})" title="Delete">üóëÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        async function refreshPaymentStatus(paymentId) {
            const creds = getCredentials();
            if (!validateCredentials(creds)) {
                showToast('error', 'Enter credentials first');
                return;
            }

            try {
                const response = await fetch(`/api/payments/${paymentId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        use_sandbox: useSandbox()
                    })
                });
                const result = await response.json();

                if (result.success) {
                    showToast('success', `Payment refreshed: ${result.response.status}`);
                    loadPaymentsOverview();
                    loadSavedPayments(); // Update dropdowns
                } else {
                    showToast('error', 'Failed to refresh payment');
                }
            } catch (error) {
                showToast('error', `Error: ${error.message}`);
            }
        }

        async function deleteLocalPayment(paymentId) {
            if (!confirm('Delete this payment from local storage?')) return;

            try {
                await fetch(`/api/local/payments/${paymentId}`, { method: 'DELETE' });
                showToast('success', 'Payment deleted');
                loadPaymentsOverview();
                loadSavedPayments(); // Update dropdowns
            } catch (error) {
                showToast('error', 'Failed to delete');
            }
        }

        async function refreshPayments() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) {
                showToast('error', 'Enter credentials to refresh payments');
                loadPaymentsOverview();
                return;
            }

            showToast('info', 'Refreshing all payments...');
            
            // Load payments first
            await loadPaymentsOverview();
            
            const response = await fetch('/api/local/payments');
            const payments = await response.json();
            
            // Then fetch status for each payment
            for (const p of payments) {
                await refreshPaymentStatus(p.payment_id);
                await new Promise(r => setTimeout(r, 300)); // Small delay between requests
            }

            loadPaymentsOverview();
            showToast('success', 'All payments refreshed');
        }

        function populateVerificationDropdowns() {
            const selects = [
                'get_verification_select',
                'docs_verification_select',
                'upload_verification_select',
                'update_state_verification_select'
            ];

            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                const currentValue = select.value;
                select.innerHTML = '<option value="">-- Or enter ID manually below --</option>';
                
                savedVerifications.forEach(v => {
                    const option = document.createElement('option');
                    option.value = v.verification_id;
                    option.textContent = `${v.first_name} ${v.last_name} (${v.client_type}) - ${v.status || 'N/A'}`;
                    option.dataset.env = v.environment;
                    select.appendChild(option);
                });
                
                if (currentValue) select.value = currentValue;
            });
        }

        function selectVerification(page) {
            const selectId = `${page}_verification_select`;
            const inputId = `${page}_verification_id`;
            const select = document.getElementById(selectId);
            const input = document.getElementById(inputId);
            
            if (select.value) {
                input.value = select.value;
                
                // If on upload page, load documents for this verification
                if (page === 'upload') {
                    loadDocumentsForVerification(select.value);
                }
            }
        }

        // ============================================
        // SAVED PAYMENTS MANAGEMENT
        // ============================================
        let savedPayments = [];

        async function loadSavedPayments() {
            try {
                const response = await fetch('/api/local/payments');
                savedPayments = await response.json();
                populatePaymentDropdowns();
            } catch (error) {
                console.error('Error loading payments:', error);
            }
        }

        function populatePaymentDropdowns() {
            // Populate all payment dropdowns
            ['payment_status'].forEach(prefix => {
                const select = document.getElementById(`${prefix}_payment_select`);
                if (!select) return;
                
                const currentValue = select.value;
                select.innerHTML = '<option value="">-- Select a payment --</option>';
                
                savedPayments.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.payment_id;
                    option.textContent = `${p.payment_id.substring(0, 20)}... - ${p.status} - ${p.currency} ${p.amount}`;
                    option.dataset.env = p.environment;
                    select.appendChild(option);
                });
                
                if (currentValue) select.value = currentValue;
            });
        }

        function selectPayment(page) {
            const selectId = `${page}_payment_select`;
            const inputId = `${page}_payment_id`;
            const select = document.getElementById(selectId);
            const input = document.getElementById(inputId);
            
            if (select.value) {
                input.value = select.value;
            }
        }

        async function loadDocumentsForVerification(verificationId) {
            try {
                const response = await fetch(`/api/local/verifications/${verificationId}/documents`);
                const documents = await response.json();
                savedDocuments[verificationId] = documents;
                populateDocumentDropdown(verificationId);
            } catch (error) {
                console.error('Error loading documents:', error);
            }
        }

        function populateDocumentDropdown(verificationId) {
            const select = document.getElementById('upload_document_select');
            select.innerHTML = '<option value="">-- Select a document --</option>';
            
            const docs = savedDocuments[verificationId] || [];
            if (docs.length === 0) {
                select.innerHTML = '<option value="">-- No documents found, fetch them first --</option>';
                return;
            }
            
            docs.forEach(d => {
                const option = document.createElement('option');
                option.value = d.document_id;
                option.textContent = `${d.document_type} - ${d.status || 'PENDING'}`;
                select.appendChild(option);
            });
        }

        function selectDocument() {
            const select = document.getElementById('upload_document_select');
            const input = document.getElementById('upload_document_id');
            if (select.value) {
                input.value = select.value;
            }
        }

        let currentUploadDocuments = [];

        async function fetchDocumentsForUpload() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const verificationId = document.getElementById('upload_verification_id').value;
            if (!verificationId) { 
                showToast('error', 'Enter verification ID first'); 
                return; 
            }

            showToast('info', 'Fetching documents...');

            try {
                const response = await fetch(`/api/verifications/${verificationId}/documents`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        use_sandbox: useSandbox()
                    })
                });
                const result = await response.json();
                
                if (result.success && result.response) {
                    const items = result.response.items || [];
                    currentUploadDocuments = items;
                    displayDocumentsList(items);
                    showToast('success', `Found ${items.length} document(s)`);
                } else {
                    showToast('error', result.error || 'Failed to fetch documents');
                    document.getElementById('documentsListCard').style.display = 'none';
                }
            } catch (error) {
                showToast('error', error.message);
            }
        }

        function displayDocumentsList(documents) {
            const card = document.getElementById('documentsListCard');
            const list = document.getElementById('documentsList');
            const countBadge = document.getElementById('docsCount');
            
            if (documents.length === 0) {
                card.style.display = 'block';
                list.innerHTML = '<div class="no-documents">No documents required for this verification</div>';
                countBadge.textContent = '0 docs';
                return;
            }

            card.style.display = 'block';
            countBadge.textContent = `${documents.length} doc${documents.length > 1 ? 's' : ''}`;

            list.innerHTML = documents.map((doc, index) => {
                const status = (doc.status || 'PENDING').toLowerCase();
                const icon = getDocIcon(doc.type);
                const isCompleted = ['completed', 'approved'].includes(status);
                
                return `
                    <div class="document-item ${isCompleted ? 'completed' : ''}" 
                         onclick="selectDocumentForUpload('${doc.id}', '${doc.type}', ${index})"
                         data-index="${index}">
                        <div class="doc-icon">${icon}</div>
                        <div class="doc-info">
                            <div class="doc-type">${doc.type || 'Unknown Document'}</div>
                            <div class="doc-id">${doc.id}</div>
                        </div>
                        <span class="doc-status ${status}">${doc.status || 'PENDING'}</span>
                    </div>
                `;
            }).join('');
        }

        function getDocIcon(docType) {
            const type = (docType || '').toLowerCase();
            if (type.includes('id') || type.includes('identity')) return 'ü™™';
            if (type.includes('address') || type.includes('proof')) return 'üè†';
            if (type.includes('selfie') || type.includes('photo')) return 'ü§≥';
            if (type.includes('bank')) return 'üè¶';
            if (type.includes('tax')) return 'üìã';
            return 'üìÑ';
        }

        function selectDocumentForUpload(docId, docType, index) {
            // Update input fields
            document.getElementById('upload_document_id').value = docId;
            document.getElementById('upload_document_type').value = docType || '';
            
            // Update visual selection
            document.querySelectorAll('.document-item').forEach((item, i) => {
                item.classList.toggle('selected', i === index);
            });
            
            showToast('success', `Selected: ${docType}`);
        }

        // ============================================
        // PAYMENT MANAGEMENT
        // ============================================
        let approvedRemitters = [];
        let approvedBeneficiaries = [];
        let selectedRemitter = null;
        let selectedBeneficiary = null;

        function togglePaymentMethodFields() {
            const paymentMethod = document.getElementById('payment_method').value;
            const cardSection = document.getElementById('card_fields_section');
            
            if (paymentMethod === 'CARD') {
                cardSection.style.display = 'block';
                // Open the section by default when shown
                if (!cardSection.classList.contains('open')) {
                    cardSection.classList.add('open');
                }
            } else {
                cardSection.style.display = 'none';
            }
        }

        async function loadPaymentParties() {
            await Promise.all([
                loadApprovedRemitters(),
                loadApprovedBeneficiaries()
            ]);
        }

        async function loadApprovedRemitters() {
            try {
                const response = await fetch('/api/local/remitters/approved');
                approvedRemitters = await response.json();
                displayRemittersList();
            } catch (error) {
                console.error('Error loading remitters:', error);
                document.getElementById('remittersList').innerHTML = 
                    '<div class="no-documents">Error loading remitters</div>';
            }
        }

        async function loadApprovedBeneficiaries() {
            try {
                const response = await fetch('/api/local/beneficiaries/approved');
                approvedBeneficiaries = await response.json();
                displayBeneficiariesList();
            } catch (error) {
                console.error('Error loading beneficiaries:', error);
                document.getElementById('beneficiariesList').innerHTML = 
                    '<div class="no-documents">Error loading beneficiaries</div>';
            }
        }

        function displayRemittersList() {
            const list = document.getElementById('remittersList');
            
            if (approvedRemitters.length === 0) {
                list.innerHTML = `
                    <div class="no-documents">
                        No approved remitters found.<br>
                        <small style="color: var(--text-muted);">Create a REMITTER verification and get it approved first.</small>
                    </div>`;
                return;
            }

            list.innerHTML = approvedRemitters.map((r, i) => `
                <div class="document-item ${selectedRemitter?.verification_id === r.verification_id ? 'selected' : ''}" 
                     onclick="selectRemitter(${i})" data-index="${i}">
                    <div class="doc-icon">üë§</div>
                    <div class="doc-info">
                        <div class="doc-type">${r.first_name} ${r.last_name}</div>
                        <div class="doc-id">${r.payment_user_id}</div>
                    </div>
                    <span class="doc-status approved">${r.status}</span>
                </div>
            `).join('');
        }

        function displayBeneficiariesList() {
            const list = document.getElementById('beneficiariesList');
            
            if (approvedBeneficiaries.length === 0) {
                list.innerHTML = `
                    <div class="no-documents">
                        No approved beneficiaries found.<br>
                        <small style="color: var(--text-muted);">Create a BENEFICIARY verification and get it approved first.</small>
                    </div>`;
                return;
            }

            list.innerHTML = approvedBeneficiaries.map((b, i) => `
                <div class="document-item ${selectedBeneficiary?.verification_id === b.verification_id ? 'selected' : ''}" 
                     onclick="selectBeneficiary(${i})" data-index="${i}">
                    <div class="doc-icon">üéØ</div>
                    <div class="doc-info">
                        <div class="doc-type">${b.first_name} ${b.last_name}</div>
                        <div class="doc-id">${b.payment_user_id}</div>
                    </div>
                    <span class="doc-status approved">${b.status}</span>
                </div>
            `).join('');
        }

        function selectRemitter(index) {
            selectedRemitter = approvedRemitters[index];
            document.getElementById('payment_remitter_user_id').value = selectedRemitter.payment_user_id || '';
            
            // Auto-fill payer info from remitter
            document.getElementById('payment_payer_name').value = `${selectedRemitter.first_name} ${selectedRemitter.last_name}`;
            document.getElementById('payment_payer_document').value = selectedRemitter.document_number || '';
            
            // Update visual selection
            document.querySelectorAll('#remittersList .document-item').forEach((item, i) => {
                item.classList.toggle('selected', i === index);
            });
            
            updatePaymentSummary();
            showToast('success', `Remitter: ${selectedRemitter.first_name} ${selectedRemitter.last_name}`);
        }

        function selectBeneficiary(index) {
            selectedBeneficiary = approvedBeneficiaries[index];
            document.getElementById('payment_beneficiary_user_id').value = selectedBeneficiary.payment_user_id || '';
            
            // Update visual selection
            document.querySelectorAll('#beneficiariesList .document-item').forEach((item, i) => {
                item.classList.toggle('selected', i === index);
            });
            
            updatePaymentSummary();
            showToast('success', `Beneficiary: ${selectedBeneficiary.first_name} ${selectedBeneficiary.last_name}`);
        }

        function updatePaymentSummary() {
            const summary = document.getElementById('paymentSummary');
            const content = document.getElementById('paymentSummaryContent');
            
            if (selectedRemitter || selectedBeneficiary) {
                summary.style.display = 'block';
                let html = '';
                if (selectedRemitter) {
                    html += `<div><strong>From:</strong> ${selectedRemitter.first_name} ${selectedRemitter.last_name}</div>`;
                }
                if (selectedBeneficiary) {
                    html += `<div><strong>To:</strong> ${selectedBeneficiary.first_name} ${selectedBeneficiary.last_name}</div>`;
                }
                content.innerHTML = html;
            } else {
                summary.style.display = 'none';
            }
        }

        function setTestDescription(code) {
            document.getElementById('payment_description').value = code;
            const messages = {
                '200': 'Test: Approved payment',
                '300': 'Test: Rejected payment',
                '302': 'Test: Insufficient funds'
            };
            showToast('info', `Description set to "${code}" - ${messages[code]}`);
        }

        async function createPayment() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const remitterUserId = document.getElementById('payment_remitter_user_id').value;
            const beneficiaryUserId = document.getElementById('payment_beneficiary_user_id').value;
            const amount = document.getElementById('payment_amount').value;

            if (!remitterUserId) {
                showToast('error', 'Select a remitter');
                return;
            }
            if (!beneficiaryUserId) {
                showToast('error', 'Select a beneficiary');
                return;
            }
            if (!amount || parseFloat(amount) <= 0) {
                showToast('error', 'Enter a valid amount');
                return;
            }

            const paymentMethod = document.getElementById('payment_method').value;
            
            // Get payer data with defaults
            const payerName = document.getElementById('payment_payer_name').value || 'John Doe';
            const payerEmail = document.getElementById('payment_payer_email').value || 'payer@example.com';
            const payerDocument = document.getElementById('payment_payer_document').value;
            
            const paymentData = {
                payment_method_id: paymentMethod,
                remitter_user_id: remitterUserId,
                beneficiary_user_id: beneficiaryUserId,
                amount: parseFloat(amount),
                currency: document.getElementById('payment_currency').value,
                country: document.getElementById('payment_country').value,
                external_reference: document.getElementById('payment_external_reference').value || `PAY-${Date.now()}`,
                subpurpose: document.getElementById('payment_subpurpose').value,
                source_of_funds: document.getElementById('payment_source_of_funds').value,
                description: document.getElementById('payment_description').value,
                notification_url: document.getElementById('payment_notification_url').value,
                payer_name: payerName,
                payer_email: payerEmail,
                payer_document: payerDocument,
            };

            // Add card data if payment method is CARD
            if (paymentMethod === 'CARD') {
                const cardToken = document.getElementById('card_token').value;
                if (cardToken) {
                    paymentData.card = { token: cardToken, capture: document.getElementById('card_capture').value };
                } else {
                    paymentData.card = {
                        holder_name: document.getElementById('card_holder_name').value,
                        number: document.getElementById('card_number').value,
                        cvv: document.getElementById('card_cvv').value,
                        expiration_month: parseInt(document.getElementById('card_exp_month').value),
                        expiration_year: parseInt(document.getElementById('card_exp_year').value),
                        capture: document.getElementById('card_capture').value
                    };
                }
            }

            try {
                const response = await fetch('/api/payments', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        payment_data: paymentData,
                        use_sandbox: useSandbox()
                    })
                });
                const result = await response.json();
                displayPaymentResponse(result);
            } catch (error) {
                displayPaymentResponse({ success: false, error: error.message });
            }
        }

        function displayPaymentResponse(result) {
            document.getElementById('paymentEmptyState').style.display = 'none';
            document.getElementById('paymentResponseContent').style.display = 'block';

            const statusEl = document.getElementById('paymentResponseStatus');
            statusEl.querySelector('.status-dot').className = `status-dot ${result.success ? 'success' : 'error'}`;
            statusEl.querySelector('span:last-child').textContent = result.success 
                ? `Success (${result.status_code})` 
                : (result.error || `Error (${result.status_code})`);

            // Show full result including debug info
            document.getElementById('paymentResponseJson').innerHTML = syntaxHighlight(result);
            
            // Reload payments overview if payment was saved locally
            if (result.success && result.saved_locally) {
                showToast('success', 'Payment saved locally!');
                loadPaymentsOverview();
                loadSavedPayments(); // Update dropdowns
            }
        }

        function copyPaymentResponse() {
            navigator.clipboard.writeText(document.getElementById('paymentResponseJson').textContent);
            showToast('success', 'Copied!');
        }

        // ============================================
        // DOCS TAB SWITCHING
        // ============================================
        
        function switchDocsTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.docs-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.docsTab === tabId);
            });
            
            // Update content
            document.querySelectorAll('.docs-content').forEach(content => {
                content.classList.toggle('active', content.id === 'docs-' + tabId);
            });
        }

        // ============================================
        // PAYOUTS FUNCTIONS
        // ============================================
        
        let selectedPayoutRemitter = null;
        let selectedPayoutBeneficiary = null;

        function loadPayoutParties() {
            loadPayoutRemitters();
            loadPayoutBeneficiaries();
        }

        async function loadPayoutRemitters() {
            try {
                const response = await fetch('/api/local/remitters/approved');
                const remitters = await response.json();
                displayPayoutRemittersList(remitters);
            } catch (error) {
                console.error('Error loading remitters:', error);
                document.getElementById('payoutRemittersList').innerHTML = 
                    '<div class="no-documents">Error loading remitters</div>';
            }
        }

        async function loadPayoutBeneficiaries() {
            try {
                const response = await fetch('/api/local/beneficiaries/approved');
                const beneficiaries = await response.json();
                displayPayoutBeneficiariesList(beneficiaries);
            } catch (error) {
                console.error('Error loading beneficiaries:', error);
                document.getElementById('payoutBeneficiariesList').innerHTML = 
                    '<div class="no-documents">Error loading beneficiaries</div>';
            }
        }

        function displayPayoutRemittersList(remitters) {
            const list = document.getElementById('payoutRemittersList');
            
            if (remitters.length === 0) {
                list.innerHTML = `
                    <div class="no-documents">
                        No approved remitters found.<br>
                        <small style="color: var(--text-muted);">Create a REMITTER verification and get it approved first.</small>
                    </div>`;
                return;
            }

            list.innerHTML = remitters.map((r, i) => `
                <div class="document-item ${selectedPayoutRemitter?.verification_id === r.verification_id ? 'selected' : ''}" 
                     onclick="selectPayoutRemitter(${i}, this)" data-index="${i}" data-user-id="${r.payment_user_id}">
                    <div class="doc-icon">üë§</div>
                    <div class="doc-info">
                        <div class="doc-type">${r.first_name} ${r.last_name}</div>
                        <div class="doc-id">${r.payment_user_id}</div>
                    </div>
                    <span class="doc-status approved">${r.status}</span>
                </div>
            `).join('');
            
            // Store remitters for selection
            window.payoutRemitters = remitters;
        }

        function displayPayoutBeneficiariesList(beneficiaries) {
            const list = document.getElementById('payoutBeneficiariesList');
            
            if (beneficiaries.length === 0) {
                list.innerHTML = `
                    <div class="no-documents">
                        No approved beneficiaries found.<br>
                        <small style="color: var(--text-muted);">Create a BENEFICIARY verification and get it approved first.</small>
                    </div>`;
                return;
            }

            list.innerHTML = beneficiaries.map((b, i) => `
                <div class="document-item ${selectedPayoutBeneficiary?.verification_id === b.verification_id ? 'selected' : ''}" 
                     onclick="selectPayoutBeneficiary(${i}, this)" data-index="${i}" data-user-id="${b.payment_user_id}">
                    <div class="doc-icon">üéØ</div>
                    <div class="doc-info">
                        <div class="doc-type">${b.first_name} ${b.last_name}</div>
                        <div class="doc-id">${b.payment_user_id}</div>
                    </div>
                    <span class="doc-status approved">${b.status}</span>
                </div>
            `).join('');
            
            // Store beneficiaries for selection
            window.payoutBeneficiaries = beneficiaries;
        }

        function selectPayoutRemitter(index) {
            selectedPayoutRemitter = window.payoutRemitters[index];
            document.getElementById('payout_remitter_user_id').value = selectedPayoutRemitter.payment_user_id || '';
            
            // Update visual selection
            document.querySelectorAll('#payoutRemittersList .document-item').forEach((item, i) => {
                item.classList.toggle('selected', i === index);
            });
            
            updatePayoutPreview();
            showToast('success', `Remitter: ${selectedPayoutRemitter.first_name} ${selectedPayoutRemitter.last_name}`);
        }

        function selectPayoutBeneficiary(index) {
            selectedPayoutBeneficiary = window.payoutBeneficiaries[index];
            document.getElementById('payout_beneficiary_user_id').value = selectedPayoutBeneficiary.payment_user_id || '';
            
            // Update visual selection
            document.querySelectorAll('#payoutBeneficiariesList .document-item').forEach((item, i) => {
                item.classList.toggle('selected', i === index);
            });
            
            updatePayoutPreview();
            showToast('success', `Beneficiary: ${selectedPayoutBeneficiary.first_name} ${selectedPayoutBeneficiary.last_name}`);
        }

        function getPayoutRequestPreview() {
            const creds = getCredentials();
            const data = {
                login: creds.login || "(from credentials)",
                pass: "********",
                external_id: document.getElementById('payout_external_id').value,
                country: document.getElementById('payout_country').value,
                bank_code: document.getElementById('payout_bank_code').value,
                bank_name: document.getElementById('payout_bank_name').value,
                bank_province: document.getElementById('payout_bank_province').value,
                bank_account: document.getElementById('payout_bank_account').value,
                account_type: document.getElementById('payout_account_type').value,
                amount: document.getElementById('payout_amount').value,
                currency: document.getElementById('payout_currency').value,
                purpose: document.getElementById('payout_purpose').value,
                remitter_user_id: document.getElementById('payout_remitter_user_id').value,
                beneficiary_user_id: document.getElementById('payout_beneficiary_user_id').value,
                subpurpose: document.getElementById('payout_subpurpose').value,
                source_of_funds: document.getElementById('payout_source_of_funds').value,
            };
            return JSON.stringify(data, null, 2);
        }

        function updatePayoutPreview() {
            const preview = document.getElementById('payoutRequestPreview');
            if (preview) {
                preview.textContent = getPayoutRequestPreview();
            }
        }

        async function createPayout() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const remitterUserId = document.getElementById('payout_remitter_user_id').value;
            const beneficiaryUserId = document.getElementById('payout_beneficiary_user_id').value;

            if (!remitterUserId) {
                showToast('error', 'Enter remitter user ID');
                return;
            }
            if (!beneficiaryUserId) {
                showToast('error', 'Enter beneficiary user ID');
                return;
            }

            const payoutData = {
                external_id: document.getElementById('payout_external_id').value || `PAYOUT-${Date.now()}`,
                country: document.getElementById('payout_country').value,
                bank_code: document.getElementById('payout_bank_code').value,
                bank_name: document.getElementById('payout_bank_name').value,
                bank_province: document.getElementById('payout_bank_province').value,
                bank_account: document.getElementById('payout_bank_account').value,
                account_type: document.getElementById('payout_account_type').value,
                amount: document.getElementById('payout_amount').value,
                currency: document.getElementById('payout_currency').value,
                purpose: document.getElementById('payout_purpose').value,
                remitter_user_id: remitterUserId,
                beneficiary_user_id: beneficiaryUserId,
                subpurpose: document.getElementById('payout_subpurpose').value,
                source_of_funds: document.getElementById('payout_source_of_funds').value,
                notification_url: document.getElementById('payout_notification_url').value,
                beneficiary_name: document.getElementById('payout_beneficiary_name').value,
                beneficiary_document: document.getElementById('payout_beneficiary_document').value,
                beneficiary_document_type: document.getElementById('payout_beneficiary_document_type').value,
            };

            try {
                const response = await fetch('/api/payouts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        payout_data: payoutData,
                        use_sandbox: useSandbox()
                    })
                });
                const result = await response.json();
                displayPayoutResponse(result);
            } catch (error) {
                displayPayoutResponse({ success: false, error: error.message });
            }
        }

        function displayPayoutResponse(result) {
            document.getElementById('payoutEmptyState').style.display = 'none';
            document.getElementById('payoutResponseContent').style.display = 'block';

            const statusEl = document.getElementById('payoutResponseStatus');
            statusEl.querySelector('.status-dot').className = `status-dot ${result.success ? 'success' : 'error'}`;
            statusEl.querySelector('span:last-child').textContent = result.success 
                ? `Success (${result.status_code})` 
                : (result.error || `Error (${result.status_code})`);

            document.getElementById('payoutResponseJson').innerHTML = syntaxHighlight(result);
        }

        function copyPayoutResponse() {
            navigator.clipboard.writeText(document.getElementById('payoutResponseJson').textContent);
            showToast('success', 'Copied!');
        }

        // ============================================
        // PAYMENT STATUS FUNCTIONS
        // ============================================
        async function getPaymentStatus() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const paymentId = document.getElementById('payment_status_payment_id').value;
            if (!paymentId) {
                showToast('error', 'Enter Payment ID');
                return;
            }

            try {
                const response = await fetch(`/api/payments/${paymentId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        use_sandbox: useSandbox()
                    })
                });
                const result = await response.json();
                displayPaymentStatus(result);
                
                // Reload payments list if successful
                if (result.success) {
                    loadSavedPayments();
                    loadPaymentsOverview();
                }
            } catch (error) {
                displayPaymentStatus({ success: false, error: error.message });
            }
        }

        function displayPaymentStatus(result) {
            document.getElementById('paymentStatusEmptyState').style.display = 'none';
            document.getElementById('paymentStatusContent').style.display = 'block';

            const statusEl = document.getElementById('paymentStatusResponseStatus');
            statusEl.querySelector('.status-dot').className = `status-dot ${result.success ? 'success' : 'error'}`;
            statusEl.querySelector('span:last-child').textContent = result.success 
                ? `Success (${result.status_code})` 
                : (result.error || `Error (${result.status_code})`);

            if (result.success && result.response) {
                const payment = result.response;
                
                // Display summary
                const summaryHtml = `
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Payment ID</div>
                            <div style="font-weight: 500; color: var(--text-primary); font-size: 13px;">${payment.id || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Order ID</div>
                            <div style="font-weight: 500; color: var(--text-primary); font-size: 13px;">${payment.order_id || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Status</div>
                            <div>${renderStatusChip(payment.status)}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Status Code</div>
                            <div style="font-weight: 500; color: var(--text-primary); font-size: 13px;">${payment.status_code || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Amount</div>
                            <div style="font-weight: 600; color: var(--accent-primary); font-size: 15px;">${payment.currency} ${payment.amount}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Country</div>
                            <div style="font-weight: 500; color: var(--text-primary); font-size: 13px;">${payment.country || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Payment Method</div>
                            <div style="font-weight: 500; color: var(--text-primary); font-size: 13px;">${payment.payment_method_id || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Payment Method Type</div>
                            <div style="font-weight: 500; color: var(--text-primary); font-size: 13px;">${payment.payment_method_type || 'N/A'}</div>
                        </div>
                        ${payment.status_detail ? `
                        <div style="grid-column: 1 / -1;">
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Status Detail</div>
                            <div style="font-weight: 400; color: var(--text-secondary); font-size: 12px;">${payment.status_detail}</div>
                        </div>
                        ` : ''}
                        ${payment.created_date ? `
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Created</div>
                            <div style="font-weight: 400; color: var(--text-secondary); font-size: 12px;">${new Date(payment.created_date).toLocaleString()}</div>
                        </div>
                        ` : ''}
                        ${payment.approved_date ? `
                        <div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">Approved</div>
                            <div style="font-weight: 400; color: var(--text-secondary); font-size: 12px;">${new Date(payment.approved_date).toLocaleString()}</div>
                        </div>
                        ` : ''}
                    </div>
                    
                    ${payment.payer ? `
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                        <div style="font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">Payer Information</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 12px;">
                            ${payment.payer.name ? `
                            <div>
                                <div style="color: var(--text-muted);">Name</div>
                                <div style="color: var(--text-primary);">${payment.payer.name}</div>
                            </div>
                            ` : ''}
                            ${payment.payer.email ? `
                            <div>
                                <div style="color: var(--text-muted);">Email</div>
                                <div style="color: var(--text-primary);">${payment.payer.email}</div>
                            </div>
                            ` : ''}
                            ${payment.payer.document ? `
                            <div>
                                <div style="color: var(--text-muted);">Document</div>
                                <div style="color: var(--text-primary);">${payment.payer.document}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${payment.card ? `
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                        <div style="font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">Card Information</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 12px;">
                            ${payment.card.holder_name ? `
                            <div>
                                <div style="color: var(--text-muted);">Holder</div>
                                <div style="color: var(--text-primary);">${payment.card.holder_name}</div>
                            </div>
                            ` : ''}
                            ${payment.card.brand ? `
                            <div>
                                <div style="color: var(--text-muted);">Brand</div>
                                <div style="color: var(--text-primary);">${payment.card.brand}</div>
                            </div>
                            ` : ''}
                            ${payment.card.last4 ? `
                            <div>
                                <div style="color: var(--text-muted);">Last 4</div>
                                <div style="color: var(--text-primary);">**** ${payment.card.last4}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    ` : ''}
                `;
                
                document.getElementById('paymentStatusSummary').innerHTML = summaryHtml;
            }

            // Show full JSON
            document.getElementById('paymentStatusJson').innerHTML = syntaxHighlight(result);
        }

        function copyPaymentStatus() {
            navigator.clipboard.writeText(document.getElementById('paymentStatusJson').textContent);
            showToast('success', 'Copied!');
        }

        function togglePaymentJson() {
            const jsonEl = document.getElementById('paymentStatusJson');
            const toggleText = document.getElementById('togglePaymentJsonText');
            
            if (jsonEl.style.display === 'none') {
                jsonEl.style.display = 'block';
                toggleText.textContent = 'Hide JSON';
            } else {
                jsonEl.style.display = 'none';
                toggleText.textContent = 'Show JSON';
            }
        }

        function clearPayoutForm() {
            // Reset selections
            selectedPayoutRemitter = null;
            selectedPayoutBeneficiary = null;
            document.getElementById('payout_remitter_user_id').value = '';
            document.getElementById('payout_beneficiary_user_id').value = '';
            
            // Clear selection highlights
            document.querySelectorAll('#payoutRemittersList .document-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelectorAll('#payoutBeneficiariesList .document-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Reset form fields
            document.getElementById('payout_external_id').value = 'test-payout-' + Date.now();
            document.getElementById('payout_bank_code').value = '0';
            document.getElementById('payout_bank_name').value = '';
            document.getElementById('payout_bank_province').value = '';
            document.getElementById('payout_bank_account').value = '';
            document.getElementById('payout_amount').value = '100.00';
            document.getElementById('payout_notification_url').value = 'https://dlocal-webhook.example.com.br';
            document.getElementById('payout_beneficiary_name').value = '';
            document.getElementById('payout_beneficiary_document').value = '';
            
            // Reset response
            document.getElementById('payoutEmptyState').style.display = 'block';
            document.getElementById('payoutResponseContent').style.display = 'none';
            
            updatePayoutPreview();
            showToast('success', 'Form cleared');
        }

        // Initialize payout preview on page load and input changes
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for payout form fields
            const payoutFields = [
                'payout_external_id', 'payout_country', 'payout_bank_code',
                'payout_bank_name', 'payout_bank_province', 'payout_bank_account', 'payout_account_type',
                'payout_amount', 'payout_currency', 'payout_purpose', 'payout_remitter_user_id',
                'payout_beneficiary_user_id', 'payout_subpurpose', 'payout_source_of_funds'
            ];
            
            payoutFields.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', updatePayoutPreview);
                    el.addEventListener('change', updatePayoutPreview);
                }
            });
            
            // Also listen for credential changes
            ['login', 'transaction_key', 'secret_key'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', updatePayoutPreview);
                    el.addEventListener('change', updatePayoutPreview);
                }
            });

            // Initial preview update
            setTimeout(updatePayoutPreview, 100);
        });

        // ============================================
        // PROFILES MANAGEMENT
        // ============================================
        const STORAGE_KEY = 'kyc_credentials_profiles';
        const LAST_PROFILE_KEY = 'kyc_last_profile';

        function getProfiles() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : {};
        }

        function saveProfiles(profiles) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(profiles));
        }

        function updateProfileDropdown() {
            const select = document.getElementById('profileSelect');
            const profiles = getProfiles();
            const currentValue = select.value;
            select.innerHTML = '<option value="">-- Select saved profile --</option>';
            Object.keys(profiles).sort().forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = `${name} (${profiles[name].environment})`;
                select.appendChild(option);
            });
            if (profiles[currentValue]) select.value = currentValue;
        }

        function loadProfile() {
            const profileName = document.getElementById('profileSelect').value;
            if (!profileName) return;
            const profiles = getProfiles();
            const profile = profiles[profileName];
            if (!profile) return;

            document.getElementById('login').value = profile.login || '';
            document.getElementById('transaction_key').value = profile.transaction_key || '';
            document.getElementById('secret_key').value = profile.secret_key || '';

            const env = profile.environment || 'sandbox';
            document.querySelectorAll('.env-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.env === env);
                if (opt.dataset.env === env) opt.querySelector('input').checked = true;
            });
            updateEnvBadge(env);
            localStorage.setItem(LAST_PROFILE_KEY, profileName);
            showToast('success', `Loaded: ${profileName}`);
        }

        function openSaveModal() {
            if (!document.getElementById('login').value) {
                showToast('error', 'Enter credentials first');
                return;
            }
            document.getElementById('saveModal').classList.add('active');
            document.getElementById('profileName').focus();
        }

        function closeModal() {
            document.getElementById('saveModal').classList.remove('active');
            document.getElementById('profileName').value = '';
        }

        function saveProfile() {
            const name = document.getElementById('profileName').value.trim();
            if (!name) { showToast('error', 'Enter a name'); return; }

            const profiles = getProfiles();
            profiles[name] = {
                login: document.getElementById('login').value,
                transaction_key: document.getElementById('transaction_key').value,
                secret_key: document.getElementById('secret_key').value,
                environment: document.querySelector('input[name="environment"]:checked').value
            };
            saveProfiles(profiles);
            updateProfileDropdown();
            document.getElementById('profileSelect').value = name;
            localStorage.setItem(LAST_PROFILE_KEY, name);
            closeModal();
            showToast('success', `Saved: ${name}`);
        }

        function deleteProfile() {
            const profileName = document.getElementById('profileSelect').value;
            if (!profileName) { showToast('error', 'Select a profile'); return; }
            if (!confirm(`Delete "${profileName}"?`)) return;

            const profiles = getProfiles();
            delete profiles[profileName];
            saveProfiles(profiles);
            if (localStorage.getItem(LAST_PROFILE_KEY) === profileName) {
                localStorage.removeItem(LAST_PROFILE_KEY);
            }
            updateProfileDropdown();
            showToast('success', `Deleted: ${profileName}`);
        }

        function loadLastProfile() {
            const last = localStorage.getItem(LAST_PROFILE_KEY);
            if (last && getProfiles()[last]) {
                document.getElementById('profileSelect').value = last;
                loadProfile();
            }
        }

        // ============================================
        // UI HELPERS
        // ============================================
        function showToast(type, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: '‚úì', error: '‚úï', info: '‚Ñπ' };
            toast.innerHTML = `<span>${icons[type] || '‚Ñπ'}</span><span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function syntaxHighlight(json) {
            if (typeof json !== 'string') json = JSON.stringify(json, null, 2);
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, match => {
                let cls = 'json-number';
                if (/^"/.test(match)) cls = /:$/.test(match) ? 'json-key' : 'json-string';
                else if (/true|false/.test(match)) cls = 'json-boolean';
                else if (/null/.test(match)) cls = 'json-null';
                return `<span class="${cls}">${match}</span>`;
            });
        }

        function updateEnvBadge(env) {
            const badge = document.getElementById('envBadge');
            badge.textContent = env.toUpperCase();
            badge.className = `badge badge-${env}`;
        }

        function toggleSection(header) {
            header.parentElement.classList.toggle('open');
        }

        function toggleClientFields() {
            const clientType = document.getElementById('client_type').value;
            document.getElementById('remitter_fields').style.display = clientType === 'REMITTER' ? 'block' : 'none';
            document.getElementById('beneficiary_fields').style.display = clientType === 'BENEFICIARY' ? 'block' : 'none';
            document.getElementById('gender_group').style.display = clientType === 'REMITTER' ? 'flex' : 'none';
        }

        function getCredentials() {
            return {
                login: document.getElementById('login').value,
                transaction_key: document.getElementById('transaction_key').value,
                secret_key: document.getElementById('secret_key').value
            };
        }

        function validateCredentials(creds) {
            if (!creds.login || !creds.transaction_key || !creds.secret_key) {
                showToast('error', 'Fill in all credentials');
                return false;
            }
            return true;
        }

        function useSandbox() {
            return document.querySelector('input[name="environment"]:checked').value === 'sandbox';
        }

        function toggleSandboxElements() {
            const isSandbox = useSandbox();
            
            // Toggle sandbox testing info boxes and buttons
            const sandboxElements = [
                'sandboxTestInfo',
                'sandboxTestButtons'
            ];
            
            sandboxElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = isSandbox ? 'block' : 'none';
                }
            });
            
            // Update description label hint
            const descLabel = document.querySelector('label[for="payment_description"]');
            if (descLabel) {
                const hint = descLabel.querySelector('span');
                if (hint) {
                    hint.style.display = isSandbox ? 'inline' : 'none';
                }
            }
        }

        // ============================================
        // FILE UPLOAD
        // ============================================
        function handleFileSelect(input) {
            const file = input.files[0];
            const nameEl = document.getElementById('selectedFileName');
            if (file) {
                nameEl.textContent = file.name;
            } else {
                nameEl.textContent = '';
            }
        }

        // Drag and drop
        const uploadArea = document.getElementById('fileUploadArea');
        if (uploadArea) {
            uploadArea.addEventListener('click', () => document.getElementById('upload_file').click());
            uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
            uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
            uploadArea.addEventListener('drop', e => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file) {
                    document.getElementById('upload_file').files = e.dataTransfer.files;
                    handleFileSelect(document.getElementById('upload_file'));
                }
            });
        }

        // ============================================
        // API CALLS
        // ============================================
        async function createVerification() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const clientType = document.getElementById('client_type').value;
            const formData = {
                external_reference: document.getElementById('external_reference').value,
                notification_url: document.getElementById('notification_url').value,
                first_name: document.getElementById('first_name').value,
                last_name: document.getElementById('last_name').value,
                document_type: document.getElementById('document_type').value,
                document_number: document.getElementById('document_number').value,
                document_country: document.getElementById('document_country').value,
                date_of_birth: document.getElementById('date_of_birth').value,
                place_of_birth: document.getElementById('place_of_birth').value,
                nationality: document.getElementById('nationality').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                address_country: document.getElementById('address_country').value,
                address_city: document.getElementById('address_city').value,
                address_zip_code: document.getElementById('address_zip_code').value,
                address_state: document.getElementById('address_state').value,
                address_street_name: document.getElementById('address_street_name').value,
                address_street_number: document.getElementById('address_street_number').value,
            };

            if (clientType === 'REMITTER') {
                formData.gender = document.getElementById('gender').value;
                formData.marital_status = document.getElementById('marital_status').value;
                formData.is_pep = document.getElementById('is_pep').checked;
                formData.is_so = document.getElementById('is_so').checked;
                formData.profession = document.getElementById('profession').value;
                formData.source_of_funds = document.getElementById('source_of_funds').value;
                formData.consent_accepted = document.getElementById('consent_accepted').checked;
            } else {
                formData.bank_account_number = document.getElementById('bank_account_number').value;
                formData.bank_code = document.getElementById('bank_code').value;
                formData.bank_branch = document.getElementById('bank_branch').value;
                formData.bank_account_type = document.getElementById('bank_account_type').value;
            }

            const btn = document.getElementById('createBtn');
            btn.disabled = true;
            btn.querySelector('.btn-text').innerHTML = '<div class="spinner"></div> Creating...';

            try {
                const response = await fetch('/api/verifications', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        form_data: formData,
                        client_type: clientType,
                        use_sandbox: useSandbox()
                    })
                });
                const result = await response.json();
                displayCreateResponse(result);
            } catch (error) {
                displayCreateResponse({ success: false, error: error.message });
            } finally {
                btn.disabled = false;
                btn.querySelector('.btn-text').textContent = 'Create Verification';
            }
        }

        function displayCreateResponse(result) {
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('responseContent').style.display = 'block';

            const statusEl = document.getElementById('responseStatus');
            const dot = statusEl.querySelector('.status-dot');
            const text = statusEl.querySelector('span:last-child');

            if (result.success) {
                dot.className = 'status-dot success';
                text.textContent = `Success (${result.status_code})`;
                // Reload saved verifications
                loadSavedVerifications();
                if (result.saved_locally) {
                    showToast('success', 'Verification saved locally!');
                }
            } else {
                dot.className = 'status-dot error';
                text.textContent = result.error ? 'Error' : `Error (${result.status_code})`;
            }

            document.getElementById('responseJson').innerHTML = syntaxHighlight(result.response || result);
            if (result.response_headers) {
                document.getElementById('responseHeadersJson').innerHTML = syntaxHighlight(result.response_headers);
            }
            if (result.body_sent) {
                document.getElementById('requestJson').innerHTML = syntaxHighlight(result.body_sent);
            }
            if (result.signature) {
                document.getElementById('signaturePreview').value = result.signature;
            }
            if (result.date) {
                document.getElementById('datePreview').value = result.date;
            }
        }

        async function getVerification() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const verificationId = document.getElementById('get_verification_id').value;
            if (!verificationId) { showToast('error', 'Enter verification ID'); return; }

            const includeClientData = document.getElementById('include_client_data').checked;

            try {
                const response = await fetch(`/api/verifications/${verificationId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        use_sandbox: useSandbox(),
                        include_client_data: includeClientData
                    })
                });
                const result = await response.json();
                displayGetResponse(result);
            } catch (error) {
                displayGetResponse({ success: false, error: error.message });
            }
        }

        function displayGetResponse(result) {
            document.getElementById('getEmptyState').style.display = 'none';
            document.getElementById('getResponseContent').style.display = 'block';

            const statusEl = document.getElementById('getResponseStatus');
            statusEl.querySelector('.status-dot').className = `status-dot ${result.success ? 'success' : 'error'}`;
            statusEl.querySelector('span:last-child').textContent = result.success ? `Success (${result.status_code})` : (result.error || `Error (${result.status_code})`);

            document.getElementById('getResponseJson').innerHTML = syntaxHighlight(result.response || result);
        }

        async function getDocuments() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const verificationId = document.getElementById('docs_verification_id').value;
            if (!verificationId) { showToast('error', 'Enter verification ID'); return; }

            try {
                const response = await fetch(`/api/verifications/${verificationId}/documents`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        use_sandbox: useSandbox()
                    })
                });
                const result = await response.json();
                displayDocsResponse(result, verificationId);
            } catch (error) {
                displayDocsResponse({ success: false, error: error.message }, null);
            }
        }

        function displayDocsResponse(result, verificationId) {
            document.getElementById('docsEmptyState').style.display = 'none';
            document.getElementById('docsResponseContent').style.display = 'block';

            const statusEl = document.getElementById('docsResponseStatus');
            statusEl.querySelector('.status-dot').className = `status-dot ${result.success ? 'success' : 'error'}`;
            statusEl.querySelector('span:last-child').textContent = result.success ? `Success (${result.status_code})` : (result.error || `Error (${result.status_code})`);

            document.getElementById('docsResponseJson').innerHTML = syntaxHighlight(result.response || result);
            
            // Reload local documents for upload page dropdown
            if (result.success && verificationId) {
                loadDocumentsForVerification(verificationId);
            }
        }

        async function uploadDocument() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const verificationId = document.getElementById('upload_verification_id').value;
            const documentId = document.getElementById('upload_document_id').value;
            const file = document.getElementById('upload_file').files[0];

            if (!verificationId || !documentId) { showToast('error', 'Enter verification & document IDs'); return; }
            if (!file) { showToast('error', 'Select a file'); return; }

            const formData = new FormData();
            formData.append('login', creds.login);
            formData.append('transaction_key', creds.transaction_key);
            formData.append('secret_key', creds.secret_key);
            formData.append('use_sandbox', useSandbox());
            formData.append('file', file);

            try {
                const response = await fetch(`/api/verifications/${verificationId}/documents/${documentId}`, {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                displayUploadResponse(result);
            } catch (error) {
                displayUploadResponse({ success: false, error: error.message });
            }
        }

        function displayUploadResponse(result) {
            document.getElementById('uploadEmptyState').style.display = 'none';
            document.getElementById('uploadResponseContent').style.display = 'block';

            const statusEl = document.getElementById('uploadResponseStatus');
            statusEl.querySelector('.status-dot').className = `status-dot ${result.success ? 'success' : 'error'}`;
            statusEl.querySelector('span:last-child').textContent = result.success ? `Success (${result.status_code})` : (result.error || `Error (${result.status_code})`);

            document.getElementById('uploadResponseJson').innerHTML = syntaxHighlight(result.response || result);
            
            // Refresh documents list if upload was successful
            if (result.success) {
                const verificationId = document.getElementById('upload_verification_id').value;
                if (verificationId) {
                    setTimeout(() => fetchDocumentsForUpload(), 1000);
                }
            }
        }

        function updateStatusDetailOptions() {
            const status = document.getElementById('update_state_status').value;
            const statusDetailSelect = document.getElementById('update_state_status_detail');
            
            // Define valid status_detail values for each status
            const statusDetailOptions = {
                'CREATING': [
                    { value: 'creating', label: 'creating - Verification is being created' }
                ],
                'PENDING': [
                    { value: 'pending', label: 'pending - Verification is pending' },
                    { value: 'documentation', label: 'documentation - Pending documentation' },
                    { value: 'compliance_review', label: 'compliance_review - Pending compliance review' },
                    { value: 'resubmit_documentation', label: 'resubmit_documentation - Requires resubmission' }
                ],
                'APPROVED': [
                    { value: 'approved', label: 'approved - Verification is approved' },
                    { value: 'approved_bypassed', label: 'approved_bypassed - Approved bypassed' }
                ],
                'REJECTED': [
                    { value: 'rejected', label: 'rejected - Verification is rejected' },
                    { value: 'validation_legal_issues', label: 'validation_legal_issues - Rejected due to legal issues' },
                    { value: 'invalid_taxid', label: 'invalid_taxid - Rejected due to invalid KYC' },
                    { value: 'high_risk', label: 'high_risk - Rejected due to high risk' }
                ],
                'EXPIRED': [
                    { value: 'expired', label: 'expired - Verification expired' },
                    { value: 'expired_doc_not_completed', label: 'expired_doc_not_completed - Documentation period elapsed' },
                    { value: 'expired_period_of_validaity', label: 'expired_period_of_validaity - Expired due to expiration date' }
                ],
                'ERROR': [
                    { value: 'error', label: 'error - An error has occurred' }
                ]
            };
            
            // Clear and populate status_detail dropdown
            statusDetailSelect.innerHTML = '<option value="">-- Select status detail --</option>';
            
            if (status && statusDetailOptions[status]) {
                statusDetailOptions[status].forEach(option => {
                    const optElement = document.createElement('option');
                    optElement.value = option.value;
                    optElement.textContent = option.label;
                    statusDetailSelect.appendChild(optElement);
                });
                
                // Auto-select first option
                if (statusDetailOptions[status].length > 0) {
                    statusDetailSelect.value = statusDetailOptions[status][0].value;
                }
            }
        }

        async function updateVerificationState() {
            const creds = getCredentials();
            if (!validateCredentials(creds)) return;

            const verificationId = document.getElementById('update_state_verification_id').value;
            const newStatus = document.getElementById('update_state_status').value;
            const statusDetail = document.getElementById('update_state_status_detail').value;
            
            if (!verificationId) { showToast('error', 'Enter verification ID'); return; }
            if (!newStatus) { showToast('error', 'Select a status'); return; }
            if (!statusDetail) { showToast('error', 'Enter status detail'); return; }
            
            // Check sandbox environment
            if (!useSandbox()) {
                showToast('error', 'This feature only works in Sandbox environment');
                return;
            }

            try {
                const response = await fetch(`/api/verifications/${verificationId}/state`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        credentials: creds,
                        use_sandbox: useSandbox(),
                        status: newStatus,
                        status_detail: statusDetail
                    })
                });
                const result = await response.json();
                displayUpdateStateResponse(result);
                
                // Reload verifications list if successful
                if (result.success) {
                    loadSavedVerifications();
                    showToast('success', 'Verification state updated!');
                }
            } catch (error) {
                displayUpdateStateResponse({ success: false, error: error.message });
            }
        }

        function displayUpdateStateResponse(result) {
            document.getElementById('updateStateEmptyState').style.display = 'none';
            document.getElementById('updateStateResponseContent').style.display = 'block';

            const statusEl = document.getElementById('updateStateResponseStatus');
            statusEl.querySelector('.status-dot').className = `status-dot ${result.success ? 'success' : 'error'}`;
            statusEl.querySelector('span:last-child').textContent = result.success ? `Success (${result.status_code})` : (result.error || `Error (${result.status_code})`);

            document.getElementById('updateStateResponseJson').innerHTML = syntaxHighlight(result.response || result);
        }

        // Copy functions
        function copyResponse() { navigator.clipboard.writeText(document.getElementById('responseJson').textContent); showToast('success', 'Copied!'); }
        function copyGetResponse() { navigator.clipboard.writeText(document.getElementById('getResponseJson').textContent); showToast('success', 'Copied!'); }
        function copyDocsResponse() { navigator.clipboard.writeText(document.getElementById('docsResponseJson').textContent); showToast('success', 'Copied!'); }
        function copyUploadResponse() { navigator.clipboard.writeText(document.getElementById('uploadResponseJson').textContent); showToast('success', 'Copied!'); }
        function copyUpdateStateResponse() { navigator.clipboard.writeText(document.getElementById('updateStateResponseJson').textContent); showToast('success', 'Copied!'); }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.getElementById('datePreview').value = new Date().toISOString();
        updateProfileDropdown();
        loadLastProfile();
        loadSavedVerifications();
        loadSavedPayments(); // Load saved payments for dropdowns
        loadPaymentsOverview(); // Load payments on startup
        toggleSandboxElements(); // Initialize sandbox UI elements visibility

        // Environment selector
        document.querySelectorAll('.env-option').forEach(opt => {
            opt.addEventListener('click', function() {
                document.querySelectorAll('.env-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                this.querySelector('input').checked = true;
                updateEnvBadge(this.dataset.env);
            });
        });

        // Page navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active'));
                this.classList.add('active');
                document.getElementById('page-' + this.dataset.page).classList.add('active');
                
                // Load overview when navigating to overview page
                if (this.dataset.page === 'overview') {
                    loadOverview();
                    loadPaymentsOverview();
                }
                
                // Load payment parties when navigating to payment page
                if (this.dataset.page === 'payment') {
                    loadPaymentParties();
                }
                
                // Load payout parties when navigating to payouts page
                if (this.dataset.page === 'payouts') {
                    loadPayoutParties();
                    updatePayoutPreview();
                }
            });
        });

        // Response tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const parent = this.closest('.card');
                parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                parent.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                parent.querySelector('#tab-' + this.dataset.tab).classList.add('active');
            });
        });

        // Modal handlers
        document.getElementById('saveModal').addEventListener('click', e => { if (e.target.id === 'saveModal') closeModal(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
        document.getElementById('profileName').addEventListener('keydown', e => { if (e.key === 'Enter') saveProfile(); });
    </script>
</body>
</html>
